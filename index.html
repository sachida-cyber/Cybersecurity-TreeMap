<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SACHIDAX ‚Äî Cybersecurity TreeMap</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='16' fill='%230047a1'/%3E%3Ctext x='50' y='57' font-size='42' text-anchor='middle' fill='white' font-family='Arial'%3ES%3C/text%3E%3C/svg%3E" />
<style>
  /* --------------------------
     Base / Layout
     --------------------------*/
  :root{
    --bg1: linear-gradient(135deg,#0f172a 0%, #0b1220 40%, #071229 100%);
    --card: rgba(255,255,255,0.04);
    --glass: rgba(255,255,255,0.03);
    --accent: #6EE7B7;
    --muted: rgba(255,255,255,0.7);
    --glass-border: rgba(255,255,255,0.06);
    --shadow: 0 8px 24px rgba(2,6,23,0.6);
    --radius: 12px;
    --font-sans: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;font-family:var(--font-sans);color:var(--muted);background:var(--bg1);}
  *{box-sizing:border-box}
  /* Header */
  header{
    position:fixed;top:0;left:0;right:0;height:68px;display:flex;align-items:center;gap:16px;padding:12px 20px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border-bottom:1px solid var(--glass-border);backdrop-filter: blur(6px);z-index:50;box-shadow:var(--shadow)
  }.logo-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Modern gradient background behind the logo image */
.logo-placeholder {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: linear-gradient(135deg, #0ea5e9, #7c3aed);
  box-shadow: 0 6px 18px rgba(124, 58, 237, 0.2);
}

/* New rule for the image */
.logo-placeholder img {
  width: 100%;
  height: 100%;
  object-fit: cover;   /* ensures image scales nicely without distortion */
  border-radius: 8px;
  display: block;
}

/* Remove or comment out this old rule (it was for the SVG) */
/* .logo-placeholder svg {
  width: 28px;
  height: 28px;
  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
} */

.brand {
  font-weight: 700;
  font-size: 18px;
  color: white;
  letter-spacing: 0.6px;
}

.ethics {
  margin-left: 18px;
  padding: 6px 10px;
  border-radius: 999px;
  background: linear-gradient(90deg, #ef4444, #f97316);
  color: white;
  font-weight: 600;
  font-size: 12px;
  box-shadow: 0 6px 14px rgba(249, 115, 22, 0.12);
}

/* Toolbar */

  /* Toolbar */
  .toolbar{margin-left:auto;display:flex;gap:8px;align-items:center}
  .btn{background:var(--glass);border:1px solid var(--glass-border);color:var(--muted);padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
  .btn:focus{outline:3px solid rgba(110,231,183,0.12)}
  input.search{min-width:200px;padding:8px 12px;border-radius:10px;border:1px solid var(--glass-border);background:transparent;color:var(--muted)}
  select{padding:8px 10px;border-radius:8px;border:1px solid var(--glass-border);background:transparent;color:var(--muted)}

  /* Main layout */
  main{padding-top:84px;height:calc(100vh - 84px);display:flex;gap:12px;padding:20px}
  .vis-wrap{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;border:1px solid var(--glass-border);box-shadow:var(--shadow);position:relative;display:flex;flex-direction:column;overflow:hidden}
  /* legend & controls */
  .topcontrols{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .legend{position:absolute;top:18px;right:18px;background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;border:1px solid var(--glass-border);font-size:13px;display:flex;gap:10px;align-items:center}
  .legend-item{display:flex;align-items:center;gap:8px}
  .legend-swatch{width:14px;height:14px;border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,0.4)}

  /* svg area */
  svg{width:100%;height:100%;overflow:visible;display:block}
  .node{cursor:pointer}
  .node rect{rx:8;fill:var(--card);stroke:rgba(255,255,255,0.04)}
  .node .label{font-size:12px;fill:white;pointer-events:none}
  .node:focus{outline:3px solid rgba(110,231,183,0.12)}
  .node .badge{font-size:11px;opacity:0.95}
  .tooltip{position:absolute;background:#061023;padding:10px;border-radius:8px;border:1px solid var(--glass-border);color:var(--muted);font-size:13px;box-shadow:0 10px 30px rgba(2,6,23,0.7);pointer-events:none;z-index:40}

  /* details panel */
  .panel{width:360px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid var(--glass-border);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px}
  .panel.collapsed{width:0;padding:0;border:none;overflow:hidden}
  .panel h3{margin:0;color:white}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;font-size:12px;border:1px solid var(--glass-border)}
  .commands pre{background:#041223;padding:10px;border-radius:8px;color:#a7f3d0;overflow:auto;font-size:13px;border:1px dashed rgba(110,231,183,0.08)}
  .link{color:#93c5fd;text-decoration:underline;font-size:13px}

  /* breadcrumbs */
  .crumbs{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center}
  .crumbs button{background:transparent;border:none;color:#9dd3b6;cursor:pointer;padding:4px;border-radius:6px}
  .crumbs button:focus{outline:2px solid rgba(110,231,183,0.12)}

  /* small helpers */
  .help-btn{background:linear-gradient(90deg,#6366f1,#06b6d4);padding:8px;border-radius:10px;color:white;border:none;font-weight:700}
  footer.note{position:absolute;left:16px;bottom:12px;font-size:12px;color:#9aa7b6}

  /* responsive */
  @media (max-width:980px){
    main{flex-direction:column}
    .panel{width:100%;order:2}
    .vis-wrap{order:1;height:64vh}
  }
</style>
</head>
<body>
<!-- Header: logo, site title, ethics banner, top controls -->
<header role="banner" aria-label="SACHIDAX header">
  <div class="logo-row">
    <div class="logo-placeholder" id="logo" aria-hidden="true">
      <img src="assets/logo.png" alt="SACHIDAX Logo" />
    </div>
    <div>
      <div class="brand">SACHIDAX</div>
      <div style="font-size:11px;color:#9bb6c9;margin-top:2px">Cybersecurity TreeMap</div>
    </div>
    <div class="ethics" role="note" aria-live="polite">
      Ethical use only ‚Äî Do not use for unauthorized access.
    </div>
  </div>

  <div class="toolbar" role="toolbar" aria-label="Top controls">
    <input id="search" class="search" placeholder="Search roles, tools, commands..." aria-label="Search nodes" />
    <select id="roleFilter" aria-label="Filter by role">
      <option value="all">Filter: All roles</option>
    </select>
    <button id="exportBtn" class="btn" title="Export visible subtree as JSON">Export JSON</button>
    <button id="helpBtn" class="help-btn" aria-haspopup="dialog" aria-controls="helpModal">Help</button>
  </div>
</header>


  <main>
    <!-- Visualization area -->
    <section class="vis-wrap" aria-label="Tree visualization">
      <div class="topcontrols" style="z-index:1">
        <div class="crumbs" id="breadcrumbs" aria-live="polite"></div>
      </div>

      <!-- Legend top-right -->
      <div class="legend" role="list" aria-label="Legend">
        <div class="legend-item"><span class="legend-swatch" id="sw-role"></span> Role</div>
        <div class="legend-item"><span class="legend-swatch" id="sw-task"></span> Task</div>
        <div class="legend-item"><span class="legend-swatch" id="sw-tool"></span> Tool</div>
        <div class="legend-item"><span class="legend-swatch" id="sw-cmd"></span> Command</div>
      </div>

      <!-- SVG canvas for D3 -->
      <div id="svgHolder" style="flex:1;position:relative;">
        <svg id="vizSVG" role="tree" aria-label="Cybersecurity hierarchical tree"></svg>
        <div class="tooltip" id="tooltip" style="display:none" role="tooltip"></div>
      </div>

      <footer class="note">Tip: click nodes to expand/collapse. Use the search to jump to nodes. Keyboard navigation supported (Tab, Enter).</footer>
    </section>

    <!-- Right-side details panel -->
    <aside class="panel" id="detailsPanel" aria-live="polite" aria-label="Node details">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="panelTitle">Select a node</h3>
        <button id="togglePanel" class="btn" aria-pressed="false" title="Collapse details">‚§∫</button>
      </div>
      <div id="panelMeta" style="font-size:13px;color:var(--muted)"></div>
      <div id="panelDesc" style="font-size:13px;color:var(--muted)"></div>
      <div class="commands" id="panelCommands"></div>
      <div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Resources</div>
        <div id="panelLinks" style="display:flex;flex-direction:column;gap:6px"></div>
      </div>
      <div style="margin-top:auto;display:flex;justify-content:space-between;align-items:center">
        <div class="tags" id="panelTags"></div>
        <div style="font-size:12px;color:#8fbab4">SACHIDAX ‚Ä¢ Learning</div>
      </div>
    </aside>
  </main>

  <!-- Help modal (hidden) -->
  <div id="helpModal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:linear-gradient(180deg,#071021,#071423);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(0,0,0,0.7);width:720px;max-width:95%;z-index:200">
    <h2 style="margin-top:0;color:white">Help & Ethics</h2>
    <p style="color:var(--muted)">This interactive map is a learning and visualization tool showing cybersecurity roles, tasks, common tools and example commands. All content is provided for <strong>defensive learning, authorized testing, and academic research only</strong>. Never use tools or commands on systems you do not own or have explicit permission to test.</p>
    <ul style="color:var(--muted)">
      <li>Use <strong>Search</strong> to find nodes ‚Äî matches will auto-expand the tree.</li>
      <li>Click a node to expand/collapse. Use <kbd>Tab</kbd> and <kbd>Enter</kbd> to navigate via keyboard.</li>
      <li>Use the <strong>Export</strong> button to download JSON of the currently visible subtree.</li>
      <li>If you are learning a tool, consult official documentation linked in the details panel before trying commands.</li>
    </ul>
    <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
      <button id="closeHelp" class="btn">Close</button>
    </div>
  </div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
/*
  SACHIDAX ‚Äî Single-file interactive tree visualization using D3 v7.

  Structure & functions:
   - DATA: embedded hierarchical JSON (5 levels: Root -> Role -> Task -> Tool -> Commands)
   - renderTree(data): renders the tree and attaches interactivity
   - collapseAll(): collapses all non-root nodes
   - expandTo(nodeId): expands path to a node
   - searchNodes(query): finds and highlights matches, auto-expands path
   - exportJSON(node): downloads JSON for a node subtree
   - Accessibility and keyboard support are added below
*/

/* =========================
   1) Embedded DATA (edit here to add roles/tasks/tools)
   - Keep structure: { name, type, description?, tags?, children: [...] }
   - Commands are leaves with type: "Command" and property "command"
   ========================= */

const DATA = {
  "name": "Cyber Security",
  "type": "Root",
  "description": "Overview of cybersecurity roles, tasks, tools, and example commands. For learning and authorized testing only.",
  "children": [

    /* --------------------- ROLE: Red Team --------------------- */
    {
      "name": "Red Team",
      "type": "Role",
      "description": "Simulated offensive security operations performed to improve organizational defenses. All activities are for authorized testing and education only.",
      "tags": ["redteam","offensive","ethical-hacking"],
      "children": [
        {
          "name": "Reconnaissance",
          "type": "Task",
          "description": "Collect open information about a target before active engagement.",
          "children": [
            {
              "name": "Nmap",
              "type": "Tool",
              "description": "Powerful network mapper used for host discovery and port scanning.",
              "tags": ["network","scanner"],
              "children": [
                {
                  "name": "nmap -sn 192.168.1.0/24",
                  "type": "Command",
                  "command": "nmap -sn 192.168.1.0/24  # Ping sweep for live hosts"
                },
                {
                  "name": "nmap -A -p- target.com",
                  "type": "Command",
                  "command": "nmap -A -p- target.com  # Full port + service detection"
                },
                {
                  "name": "nmap --script vuln target.com",
                  "type": "Command",
                  "command": "nmap --script vuln target.com  # Run vulnerability scripts"
                },
                {
                  "name": "# Use only on assets authorized for testing",
                  "type": "Command",
                  "command": "# Use only on assets authorized for testing"
                }
              ]
            },
            {
              "name": "Masscan",
              "type": "Tool",
              "description": "High-speed port scanner capable of scanning entire IP ranges rapidly.",
              "tags": ["scanner","network"],
              "children": [
                {
                  "name": "masscan 0.0.0.0/0 -p80,443 --rate 1000",
                  "type": "Command",
                  "command": "masscan 0.0.0.0/0 -p80,443 --rate 1000"
                },
                {
                  "name": "masscan -iL targets.txt -oX results.xml",
                  "type": "Command",
                  "command": "masscan -iL targets.txt -oX results.xml"
                },
                {
                  "name": "# Limit rate and scope to approved networks",
                  "type": "Command",
                  "command": "# Limit rate and scope to approved networks"
                }
              ]
            },
            {
          "name":"Amass",
          "type":"Tool",
          "description":"Subdomain enumeration and DNS asset mapping suite.",
          "tags":["dns","osint"],
          "children":[
            {"name":"amass enum -d example.com -o subdomains.txt","type":"Command","command":"amass enum -d example.com -o subdomains.txt"},
            {"name":"amass viz -d3 -o graph.html","type":"Command","command":"amass viz -d3 -o graph.html"},
            {"name":"# Combine with WHOIS data ethically","type":"Command","command":"# Combine with WHOIS data ethically"}
          ]
        },
        {
          "name":"Subfinder",
          "type":"Tool",
          "description":"Fast passive subdomain enumeration via public sources.",
          "tags":["osint","dns"],
          "children":[
            {"name":"subfinder -d example.com -o subs.txt","type":"Command","command":"subfinder -d example.com -o subs.txt"},
            {"name":"cat subs.txt | httprobe","type":"Command","command":"cat subs.txt | httprobe"},
            {"name":"# Do not target production without consent","type":"Command","command":"# Do not target production without consent"}
          ]
        },
        {
          "name":"Censys",
          "type":"Tool",
          "description":"Internet-wide scanning and search engine for recon intelligence.",
          "tags":["intel","recon"],
          "children":[
            {"name":"censys search 'services.service_name:HTTP'","type":"Command","command":"censys search 'services.service_name:HTTP'"},
            {"name":"# Requires API key for large queries","type":"Command","command":"# Requires API key for large queries"},
            {"name":"censys view <fingerprint>","type":"Command","command":"censys view <fingerprint>"}
          ]
        },
        {
          "name":"Shodan CLI",
          "type":"Tool",
          "description":"Search engine for Internet-connected devices; useful for recon of exposed assets.",
          "tags":["osint","recon"],
          "children":[
            {"name":"shodan search apache country:IN","type":"Command","command":"shodan search apache country:IN"},
            {"name":"shodan download results.json.gz 'nginx port:443'","type":"Command","command":"shodan download results.json.gz 'nginx port:443'"},
            {"name":"# Use for awareness, not exploitation","type":"Command","command":"# Use for awareness, not exploitation"}
          ]
        },
        {
          "name":"Recon-ng",
          "type":"Tool",
          "description":"Web-based recon framework with modules for hosts, contacts, and domains.",
          "tags":["framework","recon"],
          "children":[
            {"name":"recon-ng","type":"Command","command":"recon-ng"},
            {"name":"add domains example.com","type":"Command","command":"add domains example.com"},
            {"name":"run","type":"Command","command":"run"},
            {"name":"# Follow site policies during scanning","type":"Command","command":"# Follow site policies during scanning"}
          ]
        },
        {
          "name":"theHarvester",
          "type":"Tool",
          "description":"Collect emails, subdomains, and hosts from public sources.",
          "tags":["osint"],
          "children":[
            {"name":"theHarvester -d example.com -b all","type":"Command","command":"theHarvester -d example.com -b all"},
            {"name":"# Combine with manual verification","type":"Command","command":"# Combine with manual verification"},
            {"name":"theHarvester -d example.com -b google -f report.html","type":"Command","command":"theHarvester -d example.com -b google -f report.html"}
          ]
        },
        {
          "name":"FOCA",
          "type":"Tool",
          "description":"Metadata extraction tool from public documents.",
          "tags":["metadata","osint"],
          "children":[
            {"name":"Upload documents to FOCA GUI","type":"Command","command":"# Use GUI to extract metadata from docs"},
            {"name":"# Identify internal usernames, paths, versions","type":"Command","command":"# Identify internal usernames, paths, versions"}
          ]
        },
        {
          "name":"SpiderFoot",
          "type":"Tool",
          "description":"Automated OSINT collection and correlation platform.",
          "tags":["osint","automation"],
          "children":[
            {"name":"spiderfoot -s example.com -m ALL -o spider.html","type":"Command","command":"spiderfoot -s example.com -m ALL -o spider.html"},
            {"name":"# Use self-hosted instance for privacy","type":"Command","command":"# Use self-hosted instance for privacy"}
          ]
        }
      ]
    },

    /* ========== Task 2: OSINT Intelligence Gathering ========== */
    {
      "name": "OSINT Intelligence Gathering",
      "type": "Task",
      "description": "Collect, correlate, and analyze public information to build intelligence profiles.",
      "children": [
        {
          "name": "Maltego",
          "type": "Tool",
          "description": "Graph-based data mining tool for link analysis and OSINT correlation.",
          "tags": ["osint","analysis"],
          "children": [
            {"name":"maltego &","type":"Command","command":"maltego &"},
            {"name":"# Run transforms for domains and persons","type":"Command","command":"# Run transforms for domains and persons"},
            {"name":"# Visualize network relationships","type":"Command","command":"# Visualize network relationships"}
          ]
        },
        {
          "name": "SpiderFoot HX",
          "type": "Tool",
          "description": "Enterprise OSINT automation for large-scale intelligence gathering.",
          "tags": ["osint","automation"],
          "children": [
            {"name":"spiderfoot --list-modules","type":"Command","command":"spiderfoot --list-modules"},
            {"name":"spiderfoot -s company.com -m sfp_shodan,sfp_whois","type":"Command","command":"spiderfoot -s company.com -m sfp_shodan,sfp_whois"},
            {"name":"# Review collected data ethically","type":"Command","command":"# Review collected data ethically"}
          ]
        },
        {
          "name": "Creepy",
          "type": "Tool",
          "description": "Geolocation OSINT tool to correlate public posts with coordinates.",
          "tags": ["osint","geo"],
          "children": [
            {"name":"creepy","type":"Command","command":"creepy"},
            {"name":"# Load Twitter and Flickr modules","type":"Command","command":"# Load Twitter and Flickr modules"},
            {"name":"# Only use for training or research","type":"Command","command":"# Only use for training or research"}
          ]
        },
        {
          "name": "ExifTool",
          "type": "Tool",
          "description": "Extract metadata from image and document files.",
          "tags": ["metadata","analysis"],
          "children": [
            {"name":"exiftool *.jpg","type":"Command","command":"exiftool *.jpg"},
            {"name":"# Identify device info or GPS tags","type":"Command","command":"# Identify device info or GPS tags"}
          ]
        },
        {
          "name": "Gitrob",
          "type": "Tool",
          "description": "Analyze GitHub repositories for sensitive data exposure.",
          "tags": ["git","osint"],
          "children": [
            {"name":"gitrob analyze org_name","type":"Command","command":"gitrob analyze org_name"},
            {"name":"# Focus on authorized org repos","type":"Command","command":"# Focus on authorized org repos"}
          ]
        }
      ]
    },

    /* ========== Task 3: Enumeration ========== */
    {
      "name": "Enumeration",
      "type": "Task",
      "description": "Actively gather detailed information about discovered hosts and services.",
      "children": [
        {
          "name": "Enum4linux",
          "type": "Tool",
          "description": "Enumerate Windows shares, users, and policies via SMB.",
          "tags": ["windows","enumeration"],
          "children": [
            {"name":"enum4linux -a 192.168.1.10","type":"Command","command":"enum4linux -a 192.168.1.10"},
            {"name":"# Identify shared folders or users","type":"Command","command":"# Identify shared folders or users"}
          ]
        },
        {
          "name": "SNMPwalk",
          "type": "Tool",
          "description": "Enumerate SNMP objects on a network device.",
          "tags": ["snmp","network"],
          "children": [
            {"name":"snmpwalk -v2c -c public 192.168.1.1","type":"Command","command":"snmpwalk -v2c -c public 192.168.1.1"},
            {"name":"# Review only authorized device OIDs","type":"Command","command":"# Review only authorized device OIDs"}
          ]
        },
        {
          "name": "Nikto",
          "type": "Tool",
          "description": "Web server scanner identifying outdated or vulnerable components.",
          "tags": ["web","scanner"],
          "children": [
            {"name":"nikto -h https://example.com","type":"Command","command":"nikto -h https://example.com"},
            {"name":"nikto -ssl -Tuning x","type":"Command","command":"nikto -ssl -Tuning x"},
            {"name":"# Non-intrusive scans only","type":"Command","command":"# Non-intrusive scans only"}
          ]
        },
        {
          "name": "LDAPsearch",
          "type": "Tool",
          "description": "Query LDAP directories for information about users and groups.",
          "tags": ["ldap","windows"],
          "children": [
            {"name":"ldapsearch -x -H ldap://target -b 'dc=example,dc=com'","type":"Command","command":"ldapsearch -x -H ldap://target -b 'dc=example,dc=com'"},
            {"name":"# Requires proper creds for legal testing","type":"Command","command":"# Requires proper creds for legal testing"}
          ]
        }
      ]
    },

    /* ========== Task 4: Scanning and Fingerprinting ========== */
    {
      "name": "Scanning and Fingerprinting",
      "type": "Task",
      "description": "Identify open services, OS types, and potential vulnerabilities.",
      "children": [
        {
          "name": "Nmap NSE Scripts",
          "type": "Tool",
          "description": "Use Nmap Scripting Engine to detect common vulnerabilities.",
          "tags": ["scanner"],
          "children": [
            {"name":"nmap --script banner,vuln -p80,443 host","type":"Command","command":"nmap --script banner,vuln -p80,443 host"},
            {"name":"# Review script outputs manually","type":"Command","command":"# Review script outputs manually"}
          ]
        },
        {
          "name": "WhatWeb",
          "type": "Tool",
          "description": "Identify web technologies and CMS versions.",
          "tags": ["web","fingerprint"],
          "children": [
            {"name":"whatweb https://example.com","type":"Command","command":"whatweb https://example.com"},
            {"name":"whatweb --aggression 1 -v target.com","type":"Command","command":"whatweb --aggression 1 -v target.com"},
            {"name":"# Keep aggression low on live sites","type":"Command","command":"# Keep aggression low on live sites"}
          ]
        },
        {
          "name": "Wappalyzer CLI",
          "type": "Tool",
          "description": "Detect frameworks and platforms used on websites.",
          "tags": ["fingerprint","web"],
          "children": [
            {"name":"wappalyzer https://target.com","type":"Command","command":"wappalyzer https://target.com"},
            {"name":"# Use for technology stack mapping","type":"Command","command":"# Use for technology stack mapping"}
          ]
        }
      ]
    },

    /* ========== Task 5: Web Enumeration ========== */
    {
      "name": "Web Enumeration",
      "type": "Task",
      "description": "Discover hidden directories, files, and endpoints on web servers.",
      "children": [
        {
          "name": "Dirb",
          "type": "Tool",
          "description": "Simple web content scanner using wordlists.",
          "tags": ["web","enumeration"],
          "children": [
            {"name":"dirb https://example.com /usr/share/wordlists/common.txt","type":"Command","command":"dirb https://example.com /usr/share/wordlists/common.txt"},
            {"name":"# Do not brute-force unauthorized hosts","type":"Command","command":"# Do not brute-force unauthorized hosts"}
          ]
        },
        {
          "name": "Gobuster",
          "type": "Tool",
          "description": "Directory and DNS brute-forcer written in Go.",
          "tags": ["web","dns"],
          "children": [
            {"name":"gobuster dir -u https://example.com -w wordlist.txt","type":"Command","command":"gobuster dir -u https://example.com -w wordlist.txt"},
            {"name":"gobuster dns -d example.com -w subdomains.txt","type":"Command","command":"gobuster dns -d example.com -w subdomains.txt"},
            {"name":"# Adjust thread count responsibly","type":"Command","command":"# Adjust thread count responsibly"}
          ]
        },
        {
          "name": "Feroxbuster",
          "type": "Tool",
          "description": "Recursive web content discovery tool for pentesters.",
          "tags": ["web","enumeration"],
          "children": [
            {"name":"feroxbuster -u https://example.com -w /usr/share/wordlists/dir.txt","type":"Command","command":"feroxbuster -u https://example.com -w /usr/share/wordlists/dir.txt"},
            {"name":"feroxbuster --depth 2 --threads 20","type":"Command","command":"feroxbuster --depth 2 --threads 20"},
            {"name":"# Limit recursion to avoid load","type":"Command","command":"# Limit recursion to avoid load"}
          ]
        },
        {
          "name": "FFUF",
          "type": "Tool",
          "description": "Fast web fuzzer for directories, parameters, and VHost discovery.",
          "tags": ["web","fuzzer"],
          "children": [
            {"name":"ffuf -u https://example.com/FUZZ -w wordlist.txt","type":"Command","command":"ffuf -u https://example.com/FUZZ -w wordlist.txt"},
            {"name":"ffuf -u https://example.com -H 'Host: FUZZ.example.com' -w subs.txt","type":"Command","command":"ffuf -u https://example.com -H 'Host: FUZZ.example.com' -w subs.txt"},
            {"name":"# Respect rate limits","type":"Command","command":"# Respect rate limits"}
          ]
        }
      ]
    }

  ]
},


    /* --------------------- ROLE: Purple Team --------------------- */
    {
      "name":"Purple Team",
      "type":"Role",
      "description":"Collaborative exercises combining Red & Blue teams to improve detection and emulation.",
      "tags":["collaboration"],
      "children":[
        {
          "name":"Adversary Emulation",
          "type":"Task",
          "description":"Designing realistic exercises to test detection.",
          "children":[
            {
              "name":"bloodhound",
              "type":"Tool",
              "description":"Active Directory analysis tool to map relationships and exposures (use in lab/consented tests).",
              "tags":["ad","analysis"],
              "children":[
                {"name":"Invoke-BloodHound -CollectionMethod All","type":"Command","command":"Invoke-BloodHound -CollectionMethod All"},
                {"name":"bloodhound-python -c all -u user -p pass","type":"Command","command":"bloodhound-python -c all -u user -p pass"},
                {"name":"# Analyze graphs in BloodHound UI","type":"Command","command":"# Analyze graphs in BloodHound UI"}
              ]
            },
            {
              "name":"empcat",
              "type":"Tool",
              "description":"(Placeholder) simulated attack orchestration helpers for purple exercises (lab use).",
              "tags":["orchestration"],
              "children":[
                {"name":"# use orchestration to run safe scenarios","type":"Command","command":"# use orchestration to run safe scenarios"},
                {"name":"echo 'exercise initiated'","type":"Command","command":"echo 'exercise initiated'"},
                {"name":"# consult playbook","type":"Command","command":"# consult playbook"}
              ]
            },
            {
              "name":"velociraptor",
              "type":"Tool",
              "description":"Endpoint visibility & collection tool for forensic and detection workflows.",
              "tags":["endpoint","collection"],
              "children":[
                {"name":"velocidade --help","type":"Command","command":"velocidade --help"},
                {"name":"velociraptor config apply","type":"Command","command":"velociraptor config apply"},
                {"name":"# Use to collect artifacts from endpoints (consent)","type":"Command","command":"# Use to collect artifacts from endpoints (consent)"}
              ]
            },
            {
              "name":"osquery-fleet",
              "type":"Tool",
              "description":"Fleet management of osquery agents to deploy queries across estate.",
              "tags":["fleet","endpoint"],
              "children":[
                {"name":"fleetctl get hosts","type":"Command","command":"fleetctl get hosts"},
                {"name":"fleetctl query list","type":"Command","command":"fleetctl query list"},
                {"name":"# Use with approved query packs","type":"Command","command":"# Use with approved query packs"}
              ]
            },
            {
              "name":"splunk-adp",
              "type":"Tool",
              "description":"(Addon) Splunk apps and detection packages for lab testing and tuning.",
              "tags":["siem"],
              "children":[
                {"name":"# Install TA and configure inputs","type":"Command","command":"# Install TA and configure inputs"},
                {"name":"# Tune detections for low false positives","type":"Command","command":"# Tune detections for low false positives"},
                {"name":"splunk restart","type":"Command","command":"splunk restart"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: SOC Analyst --------------------- */
/* --------------------- ROLE: SOC Analyst 2025 --------------------- */
{
  "name": "SOC Analyst",
  "type": "Role",
  "description": "Security Operations Center professionals responsible for detection, analysis, and response using modern cloud and AI-powered tools in 2025.",
  "tags": ["monitoring", "response", "threat-hunting", "forensics", "automation"],
  "children": [

    /* 1Ô∏è‚É£ EVENT: Security Monitoring */
    {
      "name": "Security Monitoring",
      "type": "Event",
      "description": "Real-time alert validation and log monitoring for suspicious behavior.",
      "children": [
        {
          "name": "Splunk",
          "type": "Tool",
          "description": "Enterprise SIEM for correlation and alert triage.",
          "children": [
            {"name": "Search failed logins", "type": "Command", "command": "index=security sourcetype=auth action=failure | stats count by user, src_ip", "use_info": "Detect brute-force or credential stuffing attempts."},
            {"name": "List recent alerts", "type": "Command", "command": "| rest /services/alerts | table title, severity, triggered_time", "use_info": "List active alerts by severity and timestamp."}
          ]
        },
        {
          "name": "Elastic Stack (ELK)",
          "type": "Tool",
          "description": "Open-source SIEM using Elasticsearch, Logstash, and Kibana.",
          "children": [
            {"name": "Query failed logins", "type": "Command", "command": "GET /logs/_search?q=auth.failure:true", "use_info": "Identify failed login events from logs."},
            {"name": "Visualize login patterns", "type": "Command", "command": "event.dataset:system.auth AND event.outcome:failure", "use_info": "Visualize failed logins per source host."}
          ]
        }
      ]
    },

    /* 2Ô∏è‚É£ EVENT: Network Analysis */
    {
      "name": "Network Analysis",
      "type": "Event",
      "description": "Capture and inspect live or historical network traffic.",
      "children": [
        {
          "name": "tcpdump",
          "type": "Tool",
          "description": "Low-level packet capture utility for network traffic investigation.",
          "children": [
            {"name": "Capture HTTP traffic", "type": "Command", "command": "tcpdump -i eth0 port 80 -w http_traffic.pcap", "use_info": "Capture web traffic packets for inspection."},
            {"name": "Analyze capture", "type": "Command", "command": "tcpdump -r http_traffic.pcap -nn", "use_info": "Read and analyze pcap file offline."}
          ]
        },
        {
          "name": "Zeek (Bro)",
          "type": "Tool",
          "description": "Network behavior analytics framework for threat hunting.",
          "children": [
            {"name": "Run live capture", "type": "Command", "command": "zeek -i eth0 local", "use_info": "Capture traffic metadata for DNS/HTTP/SSL analysis."},
            {"name": "Extract DNS queries", "type": "Command", "command": "cut -f9 dns.log | sort | uniq -c", "use_info": "List top queried domains for anomaly detection."}
          ]
        },
        {
          "name": "Suricata",
          "type": "Tool",
          "description": "IDS/IPS engine for packet inspection and alerting.",
          "children": [
            {"name": "Run Suricata live", "type": "Command", "command": "suricata -c /etc/suricata/suricata.yaml -i eth0", "use_info": "Detect network threats using signature-based rules."},
            {"name": "Parse alerts", "type": "Command", "command": "jq '.alert.signature' /var/log/suricata/eve.json | sort | uniq -c", "use_info": "Summarize alerts from Suricata Eve logs."}
          ]
        }
      ]
    },

    /* 3Ô∏è‚É£ EVENT: Endpoint Monitoring */
    {
      "name": "Endpoint Monitoring",
      "type": "Event",
      "description": "Monitor host activity using EDR tools for suspicious processes or persistence.",
      "children": [
        {
          "name": "OSQuery",
          "type": "Tool",
          "description": "Endpoint visibility and query framework using SQL syntax.",
          "children": [
            {"name": "List processes", "type": "Command", "command": "osqueryi 'SELECT pid, name, path FROM processes;'", "use_info": "Detect unauthorized running processes."},
            {"name": "Check startup items", "type": "Command", "command": "osqueryi 'SELECT * FROM startup_items;'", "use_info": "Detect persistence mechanisms."}
          ]
        },
        {
          "name": "Velociraptor",
          "type": "Tool",
          "description": "DFIR and endpoint telemetry collection platform.",
          "children": [
            {"name": "Collect system info", "type": "Command", "command": "velociraptor query 'SELECT * FROM info()'", "use_info": "Collect host system metadata."},
            {"name": "Search autoruns", "type": "Command", "command": "velociraptor query 'SELECT * FROM artifacts.Windows.Registry.RunKeys()'", "use_info": "Detect persistence registry keys."}
          ]
        }
      ]
    },

    /* 4Ô∏è‚É£ EVENT: Threat Intelligence */
    {
      "name": "Threat Intelligence",
      "type": "Event",
      "description": "Enrich alerts using global threat data and IOC reputation services.",
      "children": [
        {
          "name": "MISP",
          "type": "Tool",
          "description": "Malware Information Sharing Platform for IOC management.",
          "children": [
            {"name": "Search domain", "type": "Command", "command": "misp-search --type=domain example.com", "use_info": "Check domain IOC in global feeds."},
            {"name": "Add IP IOC", "type": "Command", "command": "misp-add --type=ip --value=203.0.113.5 --category='Network activity'", "use_info": "Share new IP indicators with peers."}
          ]
        },
        {
          "name": "VirusTotal CLI",
          "type": "Tool",
          "description": "Check file hashes and URLs using VirusTotal database.",
          "children": [
            {"name": "Scan hash", "type": "Command", "command": "vt file 44d88612fea8a8f36de82e1278abb02f", "use_info": "Check known malware hash reputation."},
            {"name": "Submit URL", "type": "Command", "command": "vt url scan https://malicious.example.com", "use_info": "Submit suspicious URLs for analysis."}
          ]
        },
        {
          "name": "AbuseIPDB",
          "type": "Tool",
          "description": "IP reputation and abuse reporting service.",
          "children": [
            {"name": "Check IP", "type": "Command", "command": "curl https://api.abuseipdb.com/api/v2/check?ipAddress=8.8.8.8", "use_info": "Retrieve abuse confidence score for given IP."}
          ]
        }
      ]
    },

    /* 5Ô∏è‚É£ EVENT: Log Analysis */
    {
      "name": "Log Analysis",
      "type": "Event",
      "description": "Filter, search, and correlate massive logs across multiple systems.",
      "children": [
        {
          "name": "jq",
          "type": "Tool",
          "description": "Command-line JSON parser.",
          "children": [
            {"name": "Filter error logs", "type": "Command", "command": "jq '.[] | select(.level==\"error\")' logs.json", "use_info": "Extract only error-level entries."},
            {"name": "List usernames", "type": "Command", "command": "jq '.user' events.json", "use_info": "Extract usernames from JSON logs."}
          ]
        },
        {
          "name": "grep",
          "type": "Tool",
          "description": "Universal log text search utility.",
          "children": [
            {"name": "Search keyword", "type": "Command", "command": "grep -i 'unauthorized' /var/log/auth.log", "use_info": "Locate authentication failure events."},
            {"name": "Recursive search", "type": "Command", "command": "grep -R 'error' /srv/logs", "use_info": "Search across multiple log files recursively."}
          ]
        }
      ]
    },

    /* 6Ô∏è‚É£ EVENT: Incident Response */
    {
      "name": "Incident Response",
      "type": "Event",
      "description": "Contain, eradicate, and recover from security incidents.",
      "children": [
        {
          "name": "Volatility",
          "type": "Tool",
          "description": "Memory forensics and analysis toolkit.",
          "children": [
            {"name": "List processes", "type": "Command", "command": "volatility -f mem.raw pslist", "use_info": "Enumerate active processes in memory dump."},
            {"name": "Dump process memory", "type": "Command", "command": "volatility -f mem.raw procdump -p 1024 -D ./dump/", "use_info": "Extract process memory for malware analysis."}
          ]
        },
        {
          "name": "Autopsy",
          "type": "Tool",
          "description": "GUI-based digital forensic investigation suite.",
          "children": [
            {"name": "Open image", "type": "Command", "command": "autopsy evidence.E01", "use_info": "Load forensic disk image for timeline analysis."}
          ]
        }
      ]
    },

    /* 7Ô∏è‚É£ EVENT: Threat Hunting */
    {
      "name": "Threat Hunting",
      "type": "Event",
      "description": "Proactive search for hidden attackers and persistence mechanisms.",
      "children": [
        {
          "name": "Sigma",
          "type": "Tool",
          "description": "Generic SIEM rule format for detection queries.",
          "children": [
            {"name": "Convert rule", "type": "Command", "command": "sigmac -t splunk rules/windows_mimikatz.yml", "use_info": "Translate Sigma rule into SIEM search syntax."}
          ]
        },
        {
          "name": "YARA",
          "type": "Tool",
          "description": "Pattern-matching engine for malware detection.",
          "children": [
            {"name": "Scan directory", "type": "Command", "command": "yara -r rules.yar /samples/", "use_info": "Scan files for known malware patterns."}
          ]
        }
      ]
    },

    /* 8Ô∏è‚É£ EVENT: Automation & SOAR */
    {
      "name": "Automation & SOAR",
      "type": "Event",
      "description": "Use automated playbooks and workflows to accelerate response.",
      "children": [
        {
          "name": "Cortex XSOAR",
          "type": "Tool",
          "description": "Security automation and orchestration platform.",
          "children": [
            {"name": "Trigger playbook", "type": "Command", "command": "xsoar-cli playbook run 'Phishing_Response'", "use_info": "Run automated incident response sequence."}
          ]
        },
        {
          "name": "TheHive",
          "type": "Tool",
          "description": "Open-source case management platform for SOC teams.",
          "children": [
            {"name": "Create new case", "type": "Command", "command": "curl -XPOST -H 'Authorization: Bearer <token>' -d '{\"title\":\"Malware Incident\"}' https://thehive/api/case", "use_info": "Programmatically create incident case from CLI."}
          ]
        }
      ]
    },

    /* 9Ô∏è‚É£ EVENT: Cloud Security */
    {
      "name": "Cloud Security",
      "type": "Event",
      "description": "Audit and monitor security posture across cloud environments.",
      "children": [
        {
          "name": "AWS CLI",
          "type": "Tool",
          "description": "Command-line access to AWS resources and audit data.",
          "children": [
            {"name": "List IAM users", "type": "Command", "command": "aws iam list-users", "use_info": "Enumerate user accounts and permissions."},
            {"name": "Check S3 bucket ACLs", "type": "Command", "command": "aws s3api get-bucket-acl --bucket critical-data", "use_info": "Review S3 access control policies."}
          ]
        },
        {
          "name": "Azure Sentinel",
          "type": "Tool",
          "description": "Microsoft cloud SIEM for hybrid environments.",
          "children": [
            {"name": "Query failed logins", "type": "Command", "command": "SecurityEvent | where EventID == 4625", "use_info": "Find Windows login failures across tenant."}
          ]
        }
      ]
    },

    /* üîü EVENT: Malware Analysis */
    {
      "name": "Malware Analysis",
      "type": "Event",
      "description": "Static and dynamic inspection of suspicious files.",
      "children": [
        {
          "name": "Ghidra",
          "type": "Tool",
          "description": "Reverse engineering tool for static code analysis.",
          "children": [
            {"name": "Open binary", "type": "Command", "command": "ghidraRun malware.exe", "use_info": "Decompile and analyze binary structure."}
          ]
        },
        {
          "name": "Cuckoo Sandbox",
          "type": "Tool",
          "description": "Automated malware sandbox environment.",
          "children": [
            {"name": "Submit sample", "type": "Command", "command": "cuckoo submit sample.exe", "use_info": "Run file in sandbox and record behavior."}
          ]
        }
      ]
    }
  ]
},

/* --------------------- ROLE: Forensics (2025 Advanced) --------------------- */
{
  "name": "Forensics",
  "type": "Role",
  "description": "Digital forensics analysts perform acquisition, preservation, and analysis of digital evidence from multiple environments ‚Äî endpoint, cloud, and network ‚Äî to support incident response and legal proceedings.",
  "tags": ["forensics", "evidence", "ir", "memory", "disk", "malware"],
  "children": [

    /* 1Ô∏è‚É£ EVENT: Disk Imaging & Acquisition */
    {
      "name": "Disk Imaging & Acquisition",
      "type": "Event",
      "description": "Creating bit-by-bit forensic images while ensuring data integrity.",
      "children": [
        {
          "name": "dcfldd",
          "type": "Tool",
          "description": "Enhanced dd with hashing support for forensic disk imaging.",
          "tags": ["disk", "imaging"],
          "children": [
            {"name": "Acquire disk image", "type": "Command", "command": "dcfldd if=/dev/sda of=/cases/disk.img hash=sha256", "use_info": "Creates a forensic image of /dev/sda while calculating SHA-256 hash for verification."},
            {"name": "Clone evidence drive", "type": "Command", "command": "dcfldd if=/dev/sdb of=/dev/sdc conv=noerror,sync", "use_info": "Duplicates evidence drive with error handling for physical damages."},
            {"name": "Verify hash integrity", "type": "Command", "command": "sha256sum /cases/disk.img", "use_info": "Ensures acquired image matches original drive hash."}
          ]
        },
        {
          "name": "Guymager",
          "type": "Tool",
          "description": "GUI-based forensic imaging tool with multi-threaded hashing.",
          "children": [
            {"name": "Start acquisition GUI", "type": "Command", "command": "guymager", "use_info": "Launches graphical interface for imaging and metadata recording."},
            {"name": "Auto-verify images", "type": "Command", "command": "guymager --verify /cases/disk.img", "use_info": "Performs post-acquisition verification of forensic images."}
          ]
        }
      ]
    },

    /* 2Ô∏è‚É£ EVENT: Memory Acquisition & Analysis */
    {
      "name": "Memory Acquisition & Analysis",
      "type": "Event",
      "description": "Capturing volatile memory and analyzing running processes and network activity.",
      "children": [
        {
          "name": "WinPmem",
          "type": "Tool",
          "description": "Memory acquisition tool for Windows systems.",
          "children": [
            {"name": "Acquire RAM dump", "type": "Command", "command": "winpmem.exe --output memdump.raw", "use_info": "Captures full volatile memory image from Windows."},
            {"name": "Verify dump hash", "type": "Command", "command": "certutil -hashfile memdump.raw SHA256", "use_info": "Validates memory image integrity post-acquisition."}
          ]
        },
        {
          "name": "Volatility3",
          "type": "Tool",
          "description": "Framework for analyzing volatile memory dumps.",
          "children": [
            {"name": "List processes", "type": "Command", "command": "vol.py -f memdump.raw windows.pslist", "use_info": "Lists all active processes in memory image."},
            {"name": "Detect hidden processes", "type": "Command", "command": "vol.py -f memdump.raw windows.psscan", "use_info": "Finds injected or terminated-but-resident processes."},
            {"name": "Analyze network sockets", "type": "Command", "command": "vol.py -f memdump.raw windows.netscan", "use_info": "Lists open TCP/UDP connections found in memory."},
            {"name": "Dump suspicious process", "type": "Command", "command": "vol.py -f memdump.raw windows.memmap --pid 1234 -D ./dump/", "use_info": "Extracts the memory space of a suspicious process for malware analysis."}
          ]
        }
      ]
    },

    /* 3Ô∏è‚É£ EVENT: File System Analysis */
    {
      "name": "File System Analysis",
      "type": "Event",
      "description": "Examining files, metadata, and deleted entries from disk images.",
      "children": [
        {
          "name": "The Sleuth Kit (TSK)",
          "type": "Tool",
          "description": "Comprehensive set of forensic tools for file system analysis.",
          "children": [
            {"name": "List partitions", "type": "Command", "command": "mmls disk.img", "use_info": "Displays partition layout of a forensic image."},
            {"name": "List directory", "type": "Command", "command": "fls -r -m / disk.img > files.txt", "use_info": "Recursively lists all files and directories."},
            {"name": "Extract file by inode", "type": "Command", "command": "icat disk.img 128 > suspect.docx", "use_info": "Extracts a file using its inode number."}
          ]
        },
        {
          "name": "Autopsy",
          "type": "Tool",
          "description": "GUI forensic suite built on top of TSK for timeline and artifact analysis.",
          "children": [
            {"name": "Launch autopsy server", "type": "Command", "command": "autopsy", "use_info": "Starts web-based forensic analysis environment."},
            {"name": "Add case evidence", "type": "Command", "command": "autopsy --add /cases/disk.img", "use_info": "Imports disk image into Autopsy for timeline analysis."}
          ]
        }
      ]
    },

    /* 4Ô∏è‚É£ EVENT: Malware Analysis */
    {
      "name": "Malware Analysis",
      "type": "Event",
      "description": "Identifying and reverse-engineering malicious executables found on systems.",
      "children": [
        {
          "name": "YARA",
          "type": "Tool",
          "description": "Pattern-matching tool for malware identification.",
          "children": [
            {"name": "Scan directory", "type": "Command", "command": "yara -r rules.yar /samples/", "use_info": "Recursively scans all samples using predefined YARA rules."},
            {"name": "Test rule", "type": "Command", "command": "yara -s detect_trojans.yar sample.exe", "use_info": "Detects known malware patterns in executables."}
          ]
        },
        {
          "name": "Ghidra",
          "type": "Tool",
          "description": "Reverse-engineering framework for binary analysis.",
          "children": [
            {"name": "Launch GUI", "type": "Command", "command": "ghidraRun", "use_info": "Opens Ghidra interface for static malware analysis."},
            {"name": "Import binary", "type": "Command", "command": "File > Import > sample.exe", "use_info": "Disassemble executable to view code flow and API calls."}
          ]
        }
      ]
    },

    /* 5Ô∏è‚É£ EVENT: Log Correlation & Analysis */
    {
      "name": "Log Correlation & Analysis",
      "type": "Event",
      "description": "Analyzing and correlating logs across systems to trace attacker behavior.",
      "children": [
        {
          "name": "grep",
          "type": "Tool",
          "description": "Text search utility for filtering log data.",
          "children": [
            {"name": "Search auth logs", "type": "Command", "command": "grep -i 'failed' /var/log/auth.log", "use_info": "Identify failed authentication attempts."},
            {"name": "Search malware mentions", "type": "Command", "command": "zgrep 'malware' /logs/*.gz", "use_info": "Scan compressed logs for malware indicators."}
          ]
        },
        {
          "name": "jq",
          "type": "Tool",
          "description": "JSON processor for log filtering and enrichment.",
          "children": [
            {"name": "Extract IPs from JSON logs", "type": "Command", "command": "jq '.src_ip' events.json | sort | uniq", "use_info": "Parses source IPs from structured logs."},
            {"name": "Filter by severity", "type": "Command", "command": "jq '.[] | select(.severity==\"critical\")' alerts.json", "use_info": "Focuses on high-severity events for triage."}
          ]
        }
      ]
    },

    /* 6Ô∏è‚É£ EVENT: Email Forensics */
    {
      "name": "Email Forensics",
      "type": "Event",
      "description": "Analyzing phishing and compromised email headers and attachments.",
      "children": [
        {
          "name": "exiftool",
          "type": "Tool",
          "description": "Metadata extractor for files, including email attachments.",
          "children": [
            {"name": "Extract metadata", "type": "Command", "command": "exiftool suspect.docx", "use_info": "Retrieves embedded metadata for author and timestamps."}
          ]
        },
        {
          "name": "mailsniffer",
          "type": "Tool",
          "description": "Analyzes email headers and attachments for phishing indicators.",
          "children": [
            {"name": "Scan eml file", "type": "Command", "command": "mailsniffer -f phishing.eml", "use_info": "Detects spoofed headers and malicious URLs."}
          ]
        }
      ]
    },

    /* 7Ô∏è‚É£ EVENT: Timeline Reconstruction */
    {
      "name": "Timeline Reconstruction",
      "type": "Event",
      "description": "Building a forensic timeline of attacker activities.",
      "children": [
        {
          "name": "log2timeline",
          "type": "Tool",
          "description": "Parses multiple evidence sources into a unified forensic timeline.",
          "children": [
            {"name": "Generate timeline", "type": "Command", "command": "log2timeline.py timeline.plaso /evidence/", "use_info": "Creates timeline from multiple system artifacts."},
            {"name": "View timeline", "type": "Command", "command": "psort.py -o l2tcsv timeline.plaso > timeline.csv", "use_info": "Exports readable CSV version of forensic timeline."}
          ]
        }
      ]
    },

    /* 8Ô∏è‚É£ EVENT: Network Artifact Analysis */
    {
      "name": "Network Artifact Analysis",
      "type": "Event",
      "description": "Investigating pcap files and network evidence for lateral movement or exfiltration.",
      "children": [
        {
          "name": "Wireshark",
          "type": "Tool",
          "description": "GUI network protocol analyzer for deep inspection.",
          "children": [
            {"name": "Open capture", "type": "Command", "command": "wireshark evidence.pcap", "use_info": "Visually inspect packets and protocols in GUI."},
            {"name": "Filter HTTP traffic", "type": "Command", "command": "tshark -r evidence.pcap -Y 'http'", "use_info": "CLI filter for HTTP sessions."}
          ]
        }
      ]
    },

    /* 9Ô∏è‚É£ EVENT: Cloud Forensics */
    {
      "name": "Cloud Forensics",
      "type": "Event",
      "description": "Collecting and analyzing cloud artifacts from AWS, Azure, and GCP.",
      "children": [
        {
          "name": "AWS CLI",
          "type": "Tool",
          "description": "Command-line interface to interact with AWS resources for evidence retrieval.",
          "children": [
            {"name": "List CloudTrail logs", "type": "Command", "command": "aws cloudtrail describe-trails", "use_info": "Identify logging setup for AWS account."},
            {"name": "Download events", "type": "Command", "command": "aws s3 cp s3://cloudtrail/logs/ ./", "use_info": "Retrieve logs for offline forensic analysis."}
          ]
        }
      ]
    },

    /* üîü EVENT: Automation & Reporting */
    {
      "name": "Automation & Reporting",
      "type": "Event",
      "description": "Streamlining forensic workflows and report generation.",
      "children": [
        {
          "name": "Python",
          "type": "Tool",
          "description": "Scripting language for automating evidence parsing.",
          "children": [
            {"name": "Parse JSON logs", "type": "Command", "command": "python3 parser.py logs.json", "use_info": "Custom parser to automate log extraction."},
            {"name": "Generate hash report", "type": "Command", "command": "python3 hash_report.py evidence/", "use_info": "Auto-generates hash verification reports."}
          ]
        },
        {
          "name": "Jupyter Notebook",
          "type": "Tool",
          "description": "Interactive analysis and reporting environment for forensic data.",
          "children": [
            {"name": "Launch Jupyter", "type": "Command", "command": "jupyter notebook", "use_info": "Open notebooks for timeline visualization and reporting."}
          ]
        }
      ]
    }
  ]
},

    /* --------------------- ROLE: Threat Intelligence --------------------- */
    {
      "name":"Threat Intelligence",
      "type":"Role",
      "description":"Collecting and analyzing information about threats to inform defenders.",
      "tags":["intel","threat"],
      "children":[
        {
          "name":"OSINT & Feeds",
          "type":"Task",
          "description":"Open-source intelligence, feed ingestion and enrichment.",
          "children":[
            {
              "name":"amass",
              "type":"Tool",
              "description":"DNS enumeration and mapping for asset discovery (use for inventory & defense).",
              "tags":["recon","dns"],
              "children":[
                {"name":"amass enum -d example.com -o amass.txt","type":"Command","command":"amass enum -d example.com -o amass.txt"},
                {"name":"amass viz -d example.com -o graph.json","type":"Command","command":"amass viz -d example.com -o graph.json"},
                {"name":"amass --help","type":"Command","command":"amass --help"}
              ]
            },
            {
              "name":"sublist3r",
              "type":"Tool",
              "description":"Subdomain enumeration tool for mapping an organization's external footprint.",
              "tags":["dns","recon"],
              "children":[
                {"name":"sublist3r -d example.com -o subs.txt","type":"Command","command":"sublist3r -d example.com -o subs.txt"},
                {"name":"# Use only against authorized scopes","type":"Command","command":"# Use only against authorized scopes"},
                {"name":"sublist3r --help","type":"Command","command":"sublist3r --help"}
              ]
            },
            {
              "name":"cve-search",
              "type":"Tool",
              "description":"Database and tools for tracking CVE information and vulnerabilities.",
              "tags":["vuln","intel"],
              "children":[
                {"name":"cve-search.py -p CVE-2020-1234","type":"Command","command":"cve-search.py -p CVE-2020-1234"},
                {"name":"# Subscribe to vulnerability feeds","type":"Command","command":"# Subscribe to vulnerability feeds"},
                {"name":"cve-search --help","type":"Command","command":"cve-search --help"}
              ]
            },
            {
              "name":"misp",
              "type":"Tool",
              "description":"Malware Information Sharing Platform for collaborative threat intel sharing.",
              "tags":["intel","sharing"],
              "children":[
                {"name":"# Use MISP instance to share events within trust groups","type":"Command","command":"# Use MISP instance to share events within trust groups"},
                {"name":"misp-modules -l","type":"Command","command":"misp-modules -l"},
                {"name":"# Validate indicators before ingestion","type":"Command","command":"# Validate indicators before ingestion"}
              ]
            },
            {
              "name":"shodan",
              "type":"Tool",
              "description":"Internet asset search engine for research and monitoring of public exposures.",
              "tags":["asset","monitoring"],
              "children":[
                {"name":"shodan host 1.2.3.4","type":"Command","command":"shodan host 1.2.3.4"},
                {"name":"shodan search 'apache' --limit 10","type":"Command","command":"shodan search 'apache' --limit 10"},
                {"name":"# Use API keys responsibly","type":"Command","command":"# Use API keys responsibly"}
              ]
            }
          ]
        }
      ]
    },

/* --------------------- ROLE: Penetration Tester --------------------- */
{
  "name": "Penetration Tester",
  "type": "Role",
  "description": "Authorized professionals who perform security assessments on networks, applications, and infrastructure to identify and mitigate vulnerabilities.",
  "tags": ["offense", "redteam", "testing"],
  "children": [
    {
      "name": "Web Application Testing",
      "type": "Event",
      "description": "Discovering web-based vulnerabilities using proxy interception, injection, and crawling.",
      "children": [
        {
          "name": "Burp Suite",
          "type": "Tool",
          "description": "Intercept and manipulate HTTP/S traffic for web app testing (authorized use only).",
          "tags": ["proxy", "scanner"],
          "children": [
            {
              "name": "burpsuite",
              "type": "Command",
              "command": "burpsuite &",
              "use_info": "Launches the Burp Suite GUI for intercepting and analyzing web traffic."
            },
            {
              "name": "burp --collaborator-server",
              "type": "Command",
              "command": "burp --collaborator-server",
              "use_info": "Starts Burp Collaborator to detect blind SSRF and DNS exfiltration."
            },
            {
              "name": "# Configure proxy 127.0.0.1:8080",
              "type": "Command",
              "command": "# Configure browser proxy for interception.",
              "use_info": "Allows interception of live HTTP/S traffic via Burp Proxy."
            }
          ]
        },
        {
          "name": "OWASP ZAP",
          "type": "Tool",
          "description": "Open-source DAST scanner for discovering OWASP Top 10 issues.",
          "tags": ["scanner", "proxy"],
          "children": [
            {
              "name": "zap.sh -daemon -port 8081",
              "type": "Command",
              "command": "zap.sh -daemon -port 8081",
              "use_info": "Runs ZAP in daemon mode for automation or API-based scans."
            },
            {
              "name": "zap-cli -p 8081 quick-scan https://target.com",
              "type": "Command",
              "command": "zap-cli -p 8081 quick-scan https://target.com",
              "use_info": "Performs a quick scan using ZAP‚Äôs CLI interface."
            },
            {
              "name": "zap-cli report -o report.html -f html",
              "type": "Command",
              "command": "zap-cli report -o report.html -f html",
              "use_info": "Generates a formatted HTML vulnerability report."
            }
          ]
        },
        {
          "name": "sqlmap",
          "type": "Tool",
          "description": "Automates SQL injection testing and exploitation (authorized use only).",
          "tags": ["web", "injection"],
          "children": [
            {
              "name": "sqlmap -u 'https://target.com/item?id=1' --batch",
              "type": "Command",
              "command": "sqlmap -u 'https://target.com/item?id=1' --batch",
              "use_info": "Tests parameterized URL for SQL injection vulnerabilities."
            },
            {
              "name": "sqlmap -r request.txt --dbs",
              "type": "Command",
              "command": "sqlmap -r request.txt --dbs",
              "use_info": "Enumerates available databases using a captured HTTP request."
            },
            {
              "name": "sqlmap --tamper=between,space2comment",
              "type": "Command",
              "command": "sqlmap --tamper=between,space2comment",
              "use_info": "Bypasses WAFs by obfuscating payloads."
            }
          ]
        },
        {
          "name": "gobuster",
          "type": "Tool",
          "description": "Fast directory and DNS brute-forcing utility.",
          "tags": ["recon", "web"],
          "children": [
            {
              "name": "gobuster dir -u https://target.com -w /usr/share/wordlists/common.txt",
              "type": "Command",
              "command": "gobuster dir -u https://target.com -w /usr/share/wordlists/common.txt",
              "use_info": "Discovers hidden directories or files on a web server."
            },
            {
              "name": "gobuster dns -d target.com -w subdomains.txt",
              "type": "Command",
              "command": "gobuster dns -d target.com -w subdomains.txt",
              "use_info": "Enumerates possible subdomains using brute-force."
            },
            {
              "name": "gobuster fuzz -u https://target.com/FUZZ -w fuzzlist.txt",
              "type": "Command",
              "command": "gobuster fuzz -u https://target.com/FUZZ -w fuzzlist.txt",
              "use_info": "Fuzzes endpoints for input validation testing."
            }
          ]
        }
      ]
    },
    {
      "name": "Network Penetration",
      "type": "Event",
      "description": "Assessing internal and external networks for exploitable weaknesses.",
      "children": [
        {
          "name": "nmap",
          "type": "Tool",
          "description": "Network scanning and service fingerprinting tool.",
          "tags": ["scanner", "network"],
          "children": [
            {
              "name": "nmap -sS -Pn -p- target.com",
              "type": "Command",
              "command": "nmap -sS -Pn -p- target.com",
              "use_info": "Performs full TCP SYN scan of all ports."
            },
            {
              "name": "nmap -A -T4 192.168.1.0/24",
              "type": "Command",
              "command": "nmap -A -T4 192.168.1.0/24",
              "use_info": "Performs aggressive scan with OS and version detection."
            },
            {
              "name": "nmap --script vuln target.com",
              "type": "Command",
              "command": "nmap --script vuln target.com",
              "use_info": "Runs Nmap‚Äôs vulnerability NSE scripts for quick checks."
            }
          ]
        },
        {
          "name": "masscan",
          "type": "Tool",
          "description": "High-speed network scanner for large IP ranges.",
          "tags": ["scanner", "speed"],
          "children": [
            {
              "name": "masscan 0.0.0.0/0 -p80,443 --rate 10000",
              "type": "Command",
              "command": "masscan 0.0.0.0/0 -p80,443 --rate 10000",
              "use_info": "Scans the entire Internet for open ports (use only in lab)."
            },
            {
              "name": "masscan 10.0.0.0/8 -p22,445 --rate 1000",
              "type": "Command",
              "command": "masscan 10.0.0.0/8 -p22,445 --rate 1000",
              "use_info": "Performs targeted internal network scans."
            },
            {
              "name": "masscan --resume paused.scan",
              "type": "Command",
              "command": "masscan --resume paused.scan",
              "use_info": "Resumes interrupted scanning sessions."
            }
          ]
        },
        {
          "name": "netcat",
          "type": "Tool",
          "description": "Swiss-army knife for network testing and reverse shells.",
          "tags": ["network", "utility"],
          "children": [
            {
              "name": "nc -lvnp 4444",
              "type": "Command",
              "command": "nc -lvnp 4444",
              "use_info": "Listens for incoming reverse shell connections."
            },
            {
              "name": "nc target.com 80",
              "type": "Command",
              "command": "nc target.com 80",
              "use_info": "Tests open connectivity to a remote port."
            },
            {
              "name": "nc -zv target.com 1-1024",
              "type": "Command",
              "command": "nc -zv target.com 1-1024",
              "use_info": "Performs simple TCP port scanning."
            }
          ]
        }
      ]
    },
    {
      "name": "Privilege Escalation & Exploitation",
      "type": "Event",
      "description": "Testing privilege escalation vectors on compromised systems.",
      "children": [
        {
          "name": "linpeas",
          "type": "Tool",
          "description": "Linux privilege escalation enumeration script.",
          "tags": ["linux", "priv-esc"],
          "children": [
            {
              "name": "wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh",
              "type": "Command",
              "command": "wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh",
              "use_info": "Downloads the latest linpeas script."
            },
            {
              "name": "chmod +x linpeas.sh && ./linpeas.sh",
              "type": "Command",
              "command": "chmod +x linpeas.sh && ./linpeas.sh",
              "use_info": "Executes linpeas for privilege escalation checks."
            },
            {
              "name": "# Review privilege escalation paths manually",
              "type": "Command",
              "command": "# Review privilege escalation paths manually",
              "use_info": "Check for sudo misconfigurations and writable binaries."
            }
          ]
        }
      ]
    }
  ]
},

    /* --------------------- ROLE: Application Security --------------------- */
    {
      "name":"Application Security",
      "type":"Role",
      "description":"Design and review secure software; conduct code review and static analysis.",
      "tags":["appsec","secure-dev"],
      "children":[
        {
          "name":"Static Analysis",
          "type":"Task",
          "description":"Automated and manual review of source code for vulnerabilities.",
          "children":[
            {
              "name":"bandit",
              "type":"Tool",
              "description":"Security linter for Python code to identify common issues.",
              "tags":["sast","python"],
              "children":[
                {"name":"bandit -r ./project -lll -f json -o bandit.json","type":"Command","command":"bandit -r ./project -lll -f json -o bandit.json"},
                {"name":"bandit --help","type":"Command","command":"bandit --help"},
                {"name":"# Review findings and triage false positives","type":"Command","command":"# Review findings and triage false positives"}
              ]
            },
            {
              "name":"semgrep",
              "type":"Tool",
              "description":"Lightweight static analysis for many languages with custom rules.",
              "tags":["sast"],
              "children":[
                {"name":"semgrep --config p/ci .","type":"Command","command":"semgrep --config p/ci ."},
                {"name":"semgrep --help","type":"Command","command":"semgrep --help"},
                {"name":"semgrep rule.yml src/","type":"Command","command":"semgrep rule.yml src/"}
              ]
            },
            {
              "name":"dependency-check",
              "type":"Tool",
              "description":"Checks project dependencies for known vulnerable versions.",
              "tags":["supply-chain"],
              "children":[
                {"name":"dependency-check.sh --project myapp --scan .","type":"Command","command":"dependency-check.sh --project myapp --scan ."},
                {"name":"dependency-check --help","type":"Command","command":"dependency-check --help"},
                {"name":"# Integrate into CI for alerts","type":"Command","command":"# Integrate into CI for alerts"}
              ]
            },
            {
              "name":"gitleaks",
              "type":"Tool",
              "description":"Scan git repositories for leaked secrets and credentials.",
              "tags":["secret-detection"],
              "children":[
                {"name":"gitleaks detect --source ./repo --report=gitleaks.json","type":"Command","command":"gitleaks detect --source ./repo --report=gitleaks.json"},
                {"name":"gitleaks --help","type":"Command","command":"gitleaks --help"},
                {"name":"# Remediate secrets found and rotate keys","type":"Command","command":"# Remediate secrets found and rotate keys"}
              ]
            },
            {
              "name":"ffuf",
              "type":"Tool",
              "description":"Fast web fuzzer for testing inputs and discovering endpoints (use within scope).",
              "tags":["fuzz","web"],
              "children":[
                {"name":"ffuf -u https://example.com/FUZZ -w wordlist.txt -mc 200","type":"Command","command":"ffuf -u https://example.com/FUZZ -w wordlist.txt -mc 200"},
                {"name":"ffuf --help","type":"Command","command":"ffuf --help"},
                {"name":"# Use in pre-production testing","type":"Command","command":"# Use in pre-production testing"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: Network Security --------------------- */
    {
      "name":"Network Security",
      "type":"Role",
      "description":"Protecting networks using segmentation, monitoring, and controls.",
      "tags":["network","security"],
      "children":[
        {
          "name":"Traffic Analysis",
          "type":"Task",
          "description":"Analyze and control network traffic to detect anomalies.",
          "children":[
            {
              "name":"tcpflow",
              "type":"Tool",
              "description":"Captures and reconstructs TCP flows for analysis (defensive lab use).",
              "tags":["network","analysis"],
              "children":[
                {"name":"tcpflow -r capture.pcap","type":"Command","command":"tcpflow -r capture.pcap"},
                {"name":"tcpflow -i eth0 port 80","type":"Command","command":"tcpflow -i eth0 port 80"},
                {"name":"tcpflow --help","type":"Command","command":"tcpflow --help"}
              ]
            },
            {
              "name":"smbclient",
              "type":"Tool",
              "description":"SMB/CIFS client useful for integration testing and debugging on networks.",
              "tags":["network","smb"],
              "children":[
                {"name":"smbclient -L //127.0.0.1 -N","type":"Command","command":"smbclient -L //127.0.0.1 -N"},
                {"name":"smbclient //127.0.0.1/share -U user","type":"Command","command":"smbclient //127.0.0.1/share -U user"},
                {"name":"smbclient --help","type":"Command","command":"smbclient --help"}
              ]
            },
            {
              "name":"socat",
              "type":"Tool",
              "description":"Network relay and utility used for testing and debugging connections.",
              "tags":["network","utility"],
              "children":[
                {"name":"socat TCP-LISTEN:8080,fork TCP:127.0.0.1:80","type":"Command","command":"socat TCP-LISTEN:8080,fork TCP:127.0.0.1:80"},
                {"name":"socat -V","type":"Command","command":"socat -V"},
                {"name":"# Use for benign tunnel testing in lab","type":"Command","command":"# Use for benign tunnel testing in lab"}
              ]
            },
            {
              "name":"ettercap",
              "type":"Tool",
              "description":"Network analysis and MITM tool (listed for defender awareness; use only in labs).",
              "tags":["analysis","awareness"],
              "children":[
                {"name":"ettercap -T -i eth0","type":"Command","command":"ettercap -T -i eth0"},
                {"name":"ettercap --help","type":"Command","command":"ettercap --help"},
                {"name":"# Use in isolated environments only","type":"Command","command":"# Use in isolated environments only"}
              ]
            },
            {
              "name":"netcat",
              "type":"Tool",
              "description":"Utility for reading/writing network sockets; used for debugging and testing.",
              "tags":["utility","network"],
              "children":[
                {"name":"nc -l 12345","type":"Command","command":"nc -l 12345"},
                {"name":"nc 127.0.0.1 12345","type":"Command","command":"nc 127.0.0.1 12345"},
                {"name":"nc -zv host 22-25","type":"Command","command":"nc -zv host 22-25"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: Cloud Security --------------------- */
    {
      "name":"Cloud Security",
      "type":"Role",
      "description":"Security for cloud platforms, identity, configuration and infrastructure as code.",
      "tags":["cloud","iac"],
      "children":[
        {
          "name":"Cloud Configuration",
          "type":"Task",
          "description":"Reviewing configurations, IAM policies and infrastructure automation.",
          "children":[
            {
              "name":"aws-cli",
              "type":"Tool",
              "description":"AWS command-line interface for managing and auditing cloud resources (use with least-privilege).",
              "tags":["aws","cli"],
              "children":[
                {"name":"aws s3 ls --profile audit","type":"Command","command":"aws s3 ls --profile audit"},
                {"name":"aws iam list-users --output table","type":"Command","command":"aws iam list-users --output table"},
                {"name":"aws sts get-caller-identity","type":"Command","command":"aws sts get-caller-identity"}
              ]
            },
            {
              "name":"gcloud",
              "type":"Tool",
              "description":"Google Cloud CLI for managing GCP resources and auditing configurations.",
              "tags":["gcp","cli"],
              "children":[
                {"name":"gcloud projects list","type":"Command","command":"gcloud projects list"},
                {"name":"gcloud iam service-accounts list","type":"Command","command":"gcloud iam service-accounts list"},
                {"name":"gcloud --help","type":"Command","command":"gcloud --help"}
              ]
            },
            {
              "name":"kubectl",
              "type":"Tool",
              "description":"Kubernetes CLI for inspecting cluster resources and security posture.",
              "tags":["k8s","cli"],
              "children":[
                {"name":"kubectl get pods -A","type":"Command","command":"kubectl get pods -A"},
                {"name":"kubectl describe pod mypod -n default","type":"Command","command":"kubectl describe pod mypod -n default"},
                {"name":"kubectl explain deployment","type":"Command","command":"kubectl explain deployment"}
              ]
            },
            {
              "name":"terraform",
              "type":"Tool",
              "description":"Infrastructure-as-code tool; used for security reviews of IaC configurations.",
              "tags":["iac","terraform"],
              "children":[
                {"name":"terraform plan -out=tfplan","type":"Command","command":"terraform plan -out=tfplan"},
                {"name":"terraform validate","type":"Command","command":"terraform validate"},
                {"name":"terraform show -json tfplan > plan.json","type":"Command","command":"terraform show -json tfplan > plan.json"}
              ]
            },
            {
              "name":"aws-config-check",
              "type":"Tool",
              "description":"(Aux) scripts and scanners for cloud configuration auditing (use in authorized accounts).",
              "tags":["audit","cloud"],
              "children":[
                {"name":"python3 check_iam.py --account 123456789012","type":"Command","command":"python3 check_iam.py --account 123456789012"},
                {"name":"# Always run in read-only mode first","type":"Command","command":"# Always run in read-only mode first"},
                {"name":"aws configservice get-resource-config-history --resource-type AWS::IAM::User","type":"Command","command":"aws configservice get-resource-config-history --resource-type AWS::IAM::User"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: Identity & Access / Misc Offensive Tools --------------------- */
    {
      "name":"Identity & Access",
      "type":"Role",
      "description":"Tools and tasks around identity management, authentication and password testing (for defenders).",
      "tags":["identity"],
      "children":[
        {
          "name":"Credential Assessment",
          "type":"Task",
          "description":"Assess password strength and authentication configurations in authorized tests.",
          "children":[
            {
              "name":"john",
              "type":"Tool",
              "description":"Password cracking tool useful for assessing password strength in lab and recovery scenarios.",
              "tags":["password"],
              "children":[
                {"name":"john --wordlist=rockyou.txt --format=nt hashfile.txt","type":"Command","command":"john --wordlist=rockyou.txt --format=nt hashfile.txt"},
                {"name":"john --show hashfile.txt","type":"Command","command":"john --show hashfile.txt"},
                {"name":"john --help","type":"Command","command":"john --help"}
              ]
            },
            {
              "name":"hashcat",
              "type":"Tool",
              "description":"GPU-accelerated password recovery tool for defenders and recovery operations.",
              "tags":["password","gpu"],
              "children":[
                {"name":"hashcat -m 1000 -a 0 hashes.txt wordlist.txt","type":"Command","command":"hashcat -m 1000 -a 0 hashes.txt wordlist.txt"},
                {"name":"hashcat --show hashes.txt","type":"Command","command":"hashcat --show hashes.txt"},
                {"name":"hashcat --help","type":"Command","command":"hashcat --help"}
              ]
            },
            {
              "name":"hydra",
              "type":"Tool",
              "description":"Brute-force login utility ‚Äî listed for awareness and authorized password auditing only.",
              "tags":["password","bruteforce"],
              "children":[
                {"name":"hydra -l admin -P passwords.txt ssh://127.0.0.1","type":"Command","command":"hydra -l admin -P passwords.txt ssh://127.0.0.1"},
                {"name":"hydra -L users.txt -P passlist.txt ftp://127.0.0.1","type":"Command","command":"hydra -L users.txt -P passlist.txt ftp://127.0.0.1"},
                {"name":"# Use only in authorized tests","type":"Command","command":"# Use only in authorized tests"}
              ]
            },
            {
              "name":"crackmapexec",
              "type":"Tool",
              "description":"Posture and assessment tool for Windows networks (use defensively in lab environments).",
              "tags":["ad","assessment"],
              "children":[
                {"name":"crackmapexec smb 192.0.2.0/24 -u user -p pass","type":"Command","command":"crackmapexec smb 192.0.2.0/24 -u user -p pass"},
                {"name":"crackmapexec --help","type":"Command","command":"crackmapexec --help"},
                {"name":"# Use to assess domain exposure in lab","type":"Command","command":"# Use to assess domain exposure in lab"}
              ]
            },
            {
              "name":"impacket",
              "type":"Tool",
              "description":"Collection of Python classes for working with network protocols ‚Äî used for research and testing with consent.",
              "tags":["protocols","python"],
              "children":[
                {"name":"python3 examples/smbserver.py share ./","type":"Command","command":"python3 examples/smbserver.py share ./"},
                {"name":"wmiexec.py user:pass@127.0.0.1","type":"Command","command":"wmiexec.py user:pass@127.0.0.1"},
                {"name":"# Use examples to learn protocols, not to abuse","type":"Command","command":"# Use examples to learn protocols, not to abuse"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: Miscellaneous Tools for Research & Utility --------------------- */
    {
      "name":"Research & Utilities",
      "type":"Role",
      "description":"General utilities used across roles for safe research and analysis.",
      "tags":["tools","research"],
      "children":[
        {
          "name":"Tooling & Lab",
          "type":"Task",
          "description":"Support utilities and lab tooling for safe experimentation and testing.",
          "children":[
            {
              "name":"git",
              "type":"Tool",
              "description":"Version control for managing code, playbooks and scripts in security projects.",
              "tags":["vcs"],
              "children":[
                {"name":"git clone https://github.com/example/repo.git","type":"Command","command":"git clone https://github.com/example/repo.git"},
                {"name":"git status","type":"Command","command":"git status"},
                {"name":"git diff HEAD~1..HEAD","type":"Command","command":"git diff HEAD~1..HEAD"}
              ]
            },
            {
              "name":"docker",
              "type":"Tool",
              "description":"Container runtime used to create isolated lab environments for safe testing.",
              "tags":["lab","container"],
              "children":[
                {"name":"docker run -it --rm alpine sh","type":"Command","command":"docker run -it --rm alpine sh"},
                {"name":"docker-compose up -d","type":"Command","command":"docker-compose up -d"},
                {"name":"docker ps -a","type":"Command","command":"docker ps -a"}
              ]
            },
            {
              "name":"jq-utils",
              "type":"Tool",
              "description":"Helper scripts built on jq for log ingestion and parsing.",
              "tags":["parsing"],
              "children":[
                {"name":"./parse_logs.sh /var/log > parsed.json","type":"Command","command":"./parse_logs.sh /var/log > parsed.json"},
                {"name":"cat parsed.json | jq '.'","type":"Command","command":"cat parsed.json | jq '.'"},
                {"name":"# Keep PII out of shared artifacts","type":"Command","command":"# Keep PII out of shared artifacts"}
              ]
            },
            {
              "name":"openvas",
              "type":"Tool",
              "description":"Vulnerability scanner for vulnerability management teams; use on authorized targets.",
              "tags":["vuln","scanner"],
              "children":[
                {"name":"openvas -sV -o report.html target","type":"Command","command":"openvas -sV -o report.html target"},
                {"name":"# Scan only with permission","type":"Command","command":"# Scan only with permission"},
                {"name":"openvas --help","type":"Command","command":"openvas --help"}
              ]
            },
            {
              "name":"cuckoo",
              "type":"Tool",
              "description":"Malware sandbox for safely executing and analyzing suspicious samples offline.",
              "tags":["malware","sandbox"],
              "children":[
                {"name":"cuckoo submit sample.bin","type":"Command","command":"cuckoo submit sample.bin"},
                {"name":"cuckoo web runserver","type":"Command","command":"cuckoo web runserver"},
                {"name":"# Use isolated networks for sandboxing","type":"Command","command":"# Use isolated networks for sandboxing"}
              ]
            }
          ]
        }
      ]
    },



    /* --------------------- ROLE: AI Security --------------------- */
    {
      "name": "AI Security",
      "type": "Role",
      "description": "Protecting AI/ML systems from data poisoning, model theft, and prompt injection attacks.",
      "tags": ["ai", "ml", "security"],
      "children": [
        {
          "name": "Model Hardening",
          "type": "Task",
          "description": "Analyze ML models for vulnerabilities and strengthen model pipelines.",
          "children": [
            {
              "name": "IBM Adversarial Robustness Toolbox",
              "type": "Tool",
              "description": "Framework for evaluating ML model robustness against adversarial attacks.",
              "tags": ["ml", "robustness"],
              "children": [
                {"name": "pip install adversarial-robustness-toolbox","type":"Command","command":"pip install adversarial-robustness-toolbox"},
                {"name": "python art_example.py","type":"Command","command":"python art_example.py"},
                {"name": "# Evaluate model defenses against perturbations","type":"Command","command":"# Evaluate model defenses against perturbations"}
              ]
            },
            {
              "name": "Foolbox",
              "type": "Tool",
              "description": "Python toolkit to create adversarial examples and test AI robustness.",
              "tags": ["ml", "testing"],
              "children": [
                {"name":"pip install foolbox","type":"Command","command":"pip install foolbox"},
                {"name":"python foolbox_attack.py","type":"Command","command":"python foolbox_attack.py"},
                {"name":"# Test image classifiers for robustness","type":"Command","command":"# Test image classifiers for robustness"}
              ]
            },
            {
              "name": "SecML",
              "type": "Tool",
              "description": "Machine learning security library for adversarial research (academic use only).",
              "tags":["adversarial","research"],
              "children":[
                {"name":"pip install secml","type":"Command","command":"pip install secml"},
                {"name":"python examples/adversarial_attack.py","type":"Command","command":"python examples/adversarial_attack.py"},
                {"name":"# Use only on local or authorized data","type":"Command","command":"# Use only on local or authorized data"}
              ]
            },
            {
              "name": "OpenAI Evals",
              "type": "Tool",
              "description": "Framework for evaluating AI model performance, safety, and reliability.",
              "tags":["evaluation","openai"],
              "children":[
                {"name":"pip install evals","type":"Command","command":"pip install evals"},
                {"name":"oaievals run evals.elsuite.basic","type":"Command","command":"oaievals run evals.elsuite.basic"},
                {"name":"# Customize evals for prompt safety","type":"Command","command":"# Customize evals for prompt safety"}
              ]
            },
            {
              "name": "ModelGuard",
              "type": "Tool",
              "description": "Prototype framework for monitoring AI model input/output for malicious activity.",
              "tags":["ai","monitoring"],
              "children":[
                {"name":"modelguard monitor --source app.log","type":"Command","command":"modelguard monitor --source app.log"},
                {"name":"# Detect abnormal inference patterns","type":"Command","command":"# Detect abnormal inference patterns"},
                {"name":"modelguard --help","type":"Command","command":"modelguard --help"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: DevSecOps --------------------- */
    {
      "name": "DevSecOps",
      "type": "Role",
      "description": "Integrating security across CI/CD pipelines for continuous assurance.",
      "tags": ["devops","ci-cd"],
      "children": [
        {
          "name":"Pipeline Security",
          "type":"Task",
          "description":"Automate code, dependency, and container scanning during builds.",
          "children":[
            {
              "name":"Trivy",
              "type":"Tool",
              "description":"Comprehensive vulnerability scanner for containers and IaC.",
              "tags":["container","scanner"],
              "children":[
                {"name":"trivy image nginx:latest","type":"Command","command":"trivy image nginx:latest"},
                {"name":"trivy fs .","type":"Command","command":"trivy fs ."},
                {"name":"# Integrate into CI workflows","type":"Command","command":"# Integrate into CI workflows"}
              ]
            },
            {
              "name":"Grype",
              "type":"Tool",
              "description":"Vulnerability scanner for container images and filesystems.",
              "tags":["scanner","container"],
              "children":[
                {"name":"grype alpine:3.12","type":"Command","command":"grype alpine:3.12"},
                {"name":"grype dir:./project","type":"Command","command":"grype dir:./project"},
                {"name":"grype --help","type":"Command","command":"grype --help"}
              ]
            },
            {
              "name":"Checkov",
              "type":"Tool",
              "description":"IaC scanner for Terraform, Kubernetes, and CloudFormation templates.",
              "tags":["iac","scanner"],
              "children":[
                {"name":"checkov -d .","type":"Command","command":"checkov -d ."},
                {"name":"checkov --download-policy","type":"Command","command":"checkov --download-policy"},
                {"name":"# Embed into CI/CD","type":"Command","command":"# Embed into CI/CD"}
              ]
            },
            {
              "name":"Snyk",
              "type":"Tool",
              "description":"Developer-first tool for dependency and container vulnerability scanning.",
              "tags":["dependency","scanner"],
              "children":[
                {"name":"snyk test","type":"Command","command":"snyk test"},
                {"name":"snyk monitor","type":"Command","command":"snyk monitor"},
                {"name":"# Authenticate with your developer account","type":"Command","command":"# Authenticate with your developer account"}
              ]
            },
            {
              "name":"GitHub Advanced Security",
              "type":"Tool",
              "description":"GitHub native code scanning, secret detection, and dependency analysis.",
              "tags":["github","ci-cd"],
              "children":[
                {"name":"gh code-scanning alert list","type":"Command","command":"gh code-scanning alert list"},
                {"name":"# View results in GitHub Security tab","type":"Command","command":"# View results in GitHub Security tab"},
                {"name":"gh secret list","type":"Command","command":"gh secret list"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: IoT Security --------------------- */
    {
      "name": "IoT Security",
      "type": "Role",
      "description": "Securing Internet of Things devices and embedded systems.",
      "tags": ["iot","embedded"],
      "children": [
        {
          "name":"Device Assessment",
          "type":"Task",
          "description":"Evaluate IoT firmware and network interfaces for vulnerabilities.",
          "children":[
            {
              "name":"Binwalk",
              "type":"Tool",
              "description":"Firmware analysis tool for extracting and inspecting embedded images.",
              "tags":["firmware","analysis"],
              "children":[
                {"name":"binwalk firmware.bin","type":"Command","command":"binwalk firmware.bin"},
                {"name":"binwalk -e firmware.bin","type":"Command","command":"binwalk -e firmware.bin"},
                {"name":"# Use on lab firmware images only","type":"Command","command":"# Use on lab firmware images only"}
              ]
            },
            {
              "name":"Firmware Mod Kit",
              "type":"Tool",
              "description":"Tool suite for unpacking and repacking firmware images.",
              "tags":["firmware"],
              "children":[
                {"name":"./extract-firmware.sh firmware.bin","type":"Command","command":"./extract-firmware.sh firmware.bin"},
                {"name":"# Modify config files carefully","type":"Command","command":"# Modify config files carefully"},
                {"name":"./repack-firmware.sh","type":"Command","command":"./repack-firmware.sh"}
              ]
            },
            {
              "name":"Ghidra",
              "type":"Tool",
              "description":"NSA‚Äôs open-source reverse engineering suite for binary analysis.",
              "tags":["re","analysis"],
              "children":[
                {"name":"ghidraRun","type":"Command","command":"ghidraRun"},
                {"name":"# Load firmware binaries for static analysis","type":"Command","command":"# Load firmware binaries for static analysis"},
                {"name":"ghidra --help","type":"Command","command":"ghidra --help"}
              ]
            },
            {
              "name":"Serial Monitor",
              "type":"Tool",
              "description":"Utility for observing UART/serial communications on IoT devices.",
              "tags":["serial","debug"],
              "children":[
                {"name":"screen /dev/ttyUSB0 115200","type":"Command","command":"screen /dev/ttyUSB0 115200"},
                {"name":"minicom -D /dev/ttyUSB0","type":"Command","command":"minicom -D /dev/ttyUSB0"},
                {"name":"# Use read-only mode for observation","type":"Command","command":"# Use read-only mode for observation"}
              ]
            },
            {
              "name":"Shodan IoT Watch",
              "type":"Tool",
              "description":"Track IoT exposure trends via public search API (defensive awareness).",
              "tags":["iot","intel"],
              "children":[
                {"name":"shodan search 'webcamxp' --limit 5","type":"Command","command":"shodan search 'webcamxp' --limit 5"},
                {"name":"# Research device fingerprints ethically","type":"Command","command":"# Research device fingerprints ethically"},
                {"name":"shodan stats --facets country:iot","type":"Command","command":"shodan stats --facets country:iot"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: Threat Hunting Automation --------------------- */
    {
      "name":"Threat Hunting Automation",
      "type":"Role",
      "description":"Automating threat-hunting workflows and investigation playbooks.",
      "tags":["automation","threathunt"],
      "children":[
        {
          "name":"Playbook Automation",
          "type":"Task",
          "description":"Use SOAR and automation tools to speed up incident detection.",
          "children":[
            {
              "name":"TheHive",
              "type":"Tool",
              "description":"Open-source incident response platform with case automation.",
              "tags":["soar","ir"],
              "children":[
                {"name":"curl http://localhost:9000/api/status","type":"Command","command":"curl http://localhost:9000/api/status"},
                {"name":"# Integrate with Cortex analyzers","type":"Command","command":"# Integrate with Cortex analyzers"},
                {"name":"hive-cli cases list","type":"Command","command":"hive-cli cases list"}
              ]
            },
            {
              "name":"Cortex",
              "type":"Tool",
              "description":"Analyzer engine for automation and enrichment tasks in SOC workflows.",
              "tags":["automation","ir"],
              "children":[
                {"name":"python cortex_cli.py analyzers","type":"Command","command":"python cortex_cli.py analyzers"},
                {"name":"# Combine with TheHive for full SOAR use","type":"Command","command":"# Combine with TheHive for full SOAR use"},
                {"name":"curl http://localhost:9001/api/analyzers","type":"Command","command":"curl http://localhost:9001/api/analyzers"}
              ]
            },
            {
              "name":"Shuffle",
              "type":"Tool",
              "description":"No-code SOAR workflow platform for building automation pipelines.",
              "tags":["soar","automation"],
              "children":[
                {"name":"shuffle app list","type":"Command","command":"shuffle app list"},
                {"name":"# Automate enrichment tasks","type":"Command","command":"# Automate enrichment tasks"},
                {"name":"shuffle run workflow.json","type":"Command","command":"shuffle run workflow.json"}
              ]
            },
            {
              "name":"StackStorm",
              "type":"Tool",
              "description":"Event-driven automation platform for security orchestration.",
              "tags":["automation","devops"],
              "children":[
                {"name":"st2 run core.local cmd='echo hi'","type":"Command","command":"st2 run core.local cmd='echo hi'"},
                {"name":"st2 action list","type":"Command","command":"st2 action list"},
                {"name":"# Integrate playbooks with alerting pipelines","type":"Command","command":"# Integrate playbooks with alerting pipelines"}
              ]
            },
            {
              "name":"Ansible Security Automation",
              "type":"Tool",
              "description":"Automates repetitive security tasks like policy enforcement and remediation.",
              "tags":["automation","ansible"],
              "children":[
                {"name":"ansible-playbook secure.yml","type":"Command","command":"ansible-playbook secure.yml"},
                {"name":"ansible-inventory --list","type":"Command","command":"ansible-inventory --list"},
                {"name":"# Use read-only checks for verification","type":"Command","command":"# Use read-only checks for verification"}
              ]
            }
          ]
        }
      ]
    },

    /* --------------------- ROLE: Malware Analysis --------------------- */
    {
      "name":"Malware Analysis",
      "type":"Role",
      "description":"Analyze and reverse-engineer malicious software samples safely.",
      "tags":["malware","analysis"],
      "children":[
        {
          "name":"Static and Dynamic Analysis",
          "type":"Task",
          "description":"Disassemble, debug, and observe malware behavior in isolated environments.",
          "children":[
            {
              "name":"Ghidra",
              "type":"Tool",
              "description":"Reverse engineering suite for disassembling and analyzing binaries.",
              "tags":["re"],
              "children":[
                {"name":"ghidraRun","type":"Command","command":"ghidraRun"},
                {"name":"# Load malicious samples in sandbox only","type":"Command","command":"# Load malicious samples in sandbox only"},
                {"name":"ghidra --help","type":"Command","command":"ghidra --help"}
              ]
            },
            {
              "name":"PEStudio",
              "type":"Tool",
              "description":"Analyze Windows PE files for indicators without executing them.",
              "tags":["static","windows"],
              "children":[
                {"name":"pestudio sample.exe","type":"Command","command":"pestudio sample.exe"},
                {"name":"# Review imports and suspicious sections","type":"Command","command":"# Review imports and suspicious sections"},
                {"name":"pestudio --help","type":"Command","command":"pestudio --help"}
              ]
            },
            {
              "name":"Procmon",
              "type":"Tool",
              "description":"Monitor real-time file, registry, and process activity (Windows).",
              "tags":["dynamic","monitor"],
              "children":[
                {"name":"procmon64.exe","type":"Command","command":"procmon64.exe"},
                {"name":"# Use filters for process behavior tracking","type":"Command","command":"# Use filters for process behavior tracking"},
                {"name":"procmon64.exe /Quiet","type":"Command","command":"procmon64.exe /Quiet"}
              ]
            },
            {
              "name":"CAPEv2",
              "type":"Tool",
              "description":"Malware sandbox for analyzing executable behavior in VMs.",
              "tags":["sandbox","automation"],
              "children":[
                {"name":"cape submit sample.exe","type":"Command","command":"cape submit sample.exe"},
                {"name":"cape tasks list","type":"Command","command":"cape tasks list"},
                {"name":"# Use isolated VM networks only","type":"Command","command":"# Use isolated VM networks only"}
              ]
            },
            {
              "name":"YARA-Rules",
              "type":"Tool",
              "description":"Advanced YARA ruleset repository for malware detection.",
              "tags":["detection"],
              "children":[
                {"name":"yara -r rules/ sample/","type":"Command","command":"yara -r rules/ sample/"},
                {"name":"# Maintain custom detection libraries","type":"Command","command":"# Maintain custom detection libraries"},
                {"name":"yara compile rules/","type":"Command","command":"yara compile rules/"}
              ]
            }
          ]
        }
      ]
    },

  ] /* end root children */
};

/* =========================
   2) Helper: ensure there are exactly 50 distinct tools
   (Our structure: 10 roles * 5 tools each = 50)
   ========================= */

/* =========================
   3) D3-based rendering & interactions (REPLACEMENT)
   ========================= */

const width = Math.max(document.documentElement.clientWidth - 460, 900);
const height = Math.max(document.documentElement.clientHeight - 220, 520);

/* SVG / zoom layer */
const svg = d3.select("#vizSVG")
  .attr("width","100%")
  .attr("height","100%")
  .attr("viewBox", `0 0 ${Math.max(width,1200)} ${Math.max(height,800)}`)
  .style("font-family", "Inter, Arial, sans-serif");

// color palette
const COLOR = {
  "Root": "#00aaff",
  "Role": "#00d4a6",
  "Task": "#ffb64d",
  "Tool": "#ff5c8a",
  "Command": "#a45eff"
};

// set legend swatches safely
try {
  d3.select("#sw-role").style("background", COLOR.Role);
  d3.select("#sw-task").style("background", COLOR.Task);
  d3.select("#sw-tool").style("background", COLOR.Tool);
  d3.select("#sw-cmd").style("background", COLOR.Command);
} catch(e){ /* ignore if not present */ }

/* zoom layer & groups */
const zoomLayer = svg.append("g").attr("class","zoomLayer");
const gLink = zoomLayer.append("g").attr("class","links");
const gNode = zoomLayer.append("g").attr("class","nodes");

/* zoom behavior */
const zoom = d3.zoom()
  .scaleExtent([0.35, 2.2])
  .on("zoom", (event) => {
    zoomLayer.attr("transform", event.transform);
  });
svg.call(zoom).on("dblclick.zoom", null);

/* Build hierarchy (use your embedded DATA) */
const root = d3.hierarchy(DATA, d => d.children);
root.x0 = height / 2;
root.y0 = 0;
root.descendants().forEach((d,i) => d.id = i);

/* collapse helper (used to start collapsed) */
function collapse(d){
  if(d.children){
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}

/* expand helper */
function expand(d){
  if(d._children){
    d.children = d._children;
    d._children = null;
  }
}

/* initially collapse everything except root's immediate children collapsed? 
   We'll collapse all children so user sees a tidy root with first-level roles visible.
*/
if(root.children){
  root.children.forEach(collapse);
}

/* tree layout (horizontal) */
const treeLayout = d3.tree().nodeSize([64, 220]);

/* tooltip reference (existing element) */
const tooltip = d3.select("#tooltip");

/* currently selected node */
let selectedNode = null;

/* diagonal curve generator (cubic) */
function diagonal(s, t){
  return `M ${s.y} ${s.x}
          C ${(s.y + t.y) / 2} ${s.x},
            ${(s.y + t.y) / 2} ${t.x},
            ${t.y} ${t.x}`;
}

/* helper colors/icons */
function typeColor(type){ return COLOR[type] || "#6b7280"; }
function iconFor(type){
  switch(type){
    case "Root": return "üåê";
    case "Role": return "üõ°Ô∏è";
    case "Task": return "‚öôÔ∏è";
    case "Tool": return "üß∞";
    case "Command": return "‚åÅ";
    default: return "‚Ä¢";
  }
}

/* wrap text for node labels */
function wrapText(textSel, width){
  textSel.each(function(){
    const text = d3.select(this);
    const words = text.text().split(/\s+/).reverse();
    let word, line = [], lineNumber = 0, lineHeight = 1.1;
    const x = +text.attr("x");
    const y = +text.attr("y");
    text.text(null);
    let tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy","0em");
    while(word = words.pop()){
      line.push(word);
      tspan.text(line.join(" "));
      if(tspan.node().getComputedTextLength() > width){
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + "em").text(word);
      }
    }
  });
}

/* Main render function (collapsible left-to-right tree) */
function renderTree(source = root){
  // compute layout
  treeLayout(root);
  const nodes = root.descendants();
  const links = root.links();

  // set horizontal spacing by depth
  nodes.forEach(d => { d.y = d.depth * 220; });

  // LINKS
  const linkSel = gLink.selectAll("path.link")
    .data(links, d => d.target.id);

  const linkEnter = linkSel.enter()
    .append("path")
    .attr("class","link")
    .attr("fill","none")
    .attr("stroke","rgba(255,255,255,0.06)")
    .attr("stroke-width",2)
    .attr("d", d => diagonal(source, source));

  linkSel.merge(linkEnter)
    .transition().duration(300)
    .attr("d", d => diagonal(d.source, d.target));

  linkSel.exit().transition().duration(200).remove();

  // NODES
  const nodeSel = gNode.selectAll("g.node")
    .data(nodes, d => d.id);

  const nodeEnter = nodeSel.enter()
    .append("g")
    .attr("class","node")
    .attr("transform", d => `translate(${source.y0},${source.x0})`)
    .attr("tabindex", 0)
    .attr("role","treeitem")
    .on("click", (event, d) => { toggleNode(d); renderTree(d); showDetails(d); focusOnNode(d); })
    .on("keydown", (event, d) => {
      if(event.key === "Enter" || event.key === " "){
        event.preventDefault(); toggleNode(d); renderTree(d); showDetails(d); focusOnNode(d);
      }
    })
    .on("mouseover", (event,d) => showTooltip(event,d) )
    .on("mouseout", hideTooltip)
    .on("focus", (event,d) => showTooltip(event,d))
    .on("blur", hideTooltip);

  // circle (joint) visual
  nodeEnter.append("circle")
    .attr("r", 0)
    .attr("fill", d => d._children ? d3.color(typeColor(d.data.type)).darker(0.5) : typeColor(d.data.type))
    .attr("stroke", "rgba(255,255,255,0.95)")
    .attr("stroke-width", 1);

  // label
  nodeEnter.append("text")
    .attr("class","label")
    .attr("x", d => d._children || d.children ? -18 : 18)
    .attr("y", 4)
    .attr("text-anchor", d => d._children || d.children ? "end" : "start")
    .style("font-size","13px")
    .style("font-weight","700")
    .style("fill","#ffffff")
    .text(d => `${iconFor(d.data.type)} ${d.data.name}`)
    .call(wrapText, 160);

  // merge + transitions
  const nodeMerge = nodeEnter.merge(nodeSel);

  nodeMerge.transition().duration(300)
    .attr("transform", d => `translate(${d.y},${d.x})`);

  nodeMerge.select("circle")
    .transition().duration(300)
    .attr("r", 8)
    .attr("fill", d => d._children ? d3.color(typeColor(d.data.type)).darker(0.5) : typeColor(d.data.type));

  nodeSel.exit().transition().duration(200).remove();

  // store positions
  nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });

  // update breadcrumbs
  updateBreadcrumbs(selectedNode || root);
}

/* toggle node children */
function toggleNode(d){
  if(d.children){
    d._children = d.children;
    d.children = null;
  } else {
    d.children = d._children;
    d._children = null;
  }
  selectedNode = d;
}

/* tooltip show/hide */
function showTooltip(event, d){
  tooltip.style("display","block")
    .html(`<strong>${d.data.name}</strong><div style="font-size:12px;color:#a5b4c1">${d.data.type}${d.data.description ? ' ‚Äî ' + d.data.description : ''}</div>`);
  const [x,y] = d3.pointer(event, document.body);
  tooltip.style("left", (x+12)+"px").style("top", (y+10)+"px");
}
function hideTooltip(){ tooltip.style("display","none"); }

/* show details in right panel (keeps previous panel IDs) */
function showDetails(d){
  const title = document.getElementById("panelTitle");
  const meta = document.getElementById("panelMeta");
  const desc = document.getElementById("panelDesc");
  const cmds = document.getElementById("panelCommands");
  const links = document.getElementById("panelLinks");
  const tags = document.getElementById("panelTags");

  if(title) title.textContent = d.data.name;
  if(meta) meta.innerHTML = `<strong>Type:</strong> ${d.data.type || '‚Äî'}`;
  if(desc) desc.textContent = d.data.description || "";

  if(cmds) {
    cmds.innerHTML = "";
    if(d.data.type === "Tool"){
      const cmdsList = (d.data.children || []).filter(c => c.type === "Command" || c.data?.type === "Command" || c.data?.command).map(c => c.data?.command || c.data?.name || c.name || c);
      if(cmdsList.length){
        const heading = document.createElement("div"); heading.style.color = "var(--muted)"; heading.textContent = "Example Commands";
        cmds.appendChild(heading);
        cmdsList.forEach(cmdTxt => {
          const pre = document.createElement("pre");
          pre.textContent = cmdTxt;
          pre.tabIndex = 0;
          pre.style.background = "#041223";
          pre.style.padding = "8px";
          pre.style.borderRadius = "8px";
          pre.style.color = "#9ee7c1";
          pre.style.marginTop = "8px";
          pre.addEventListener("click", ()=> navigator.clipboard && navigator.clipboard.writeText(pre.textContent));
          cmds.appendChild(pre);
        });
      }
    }
  }

  if(links){
    links.innerHTML = "";
    const resources = recommendResources(d.data);
    resources.forEach(r => {
      const a = document.createElement("a");
      a.href = r.url; a.textContent = r.label; a.target="_blank"; a.rel="noopener noreferrer";
      a.className = "link";
      links.appendChild(a);
    });
  }

  if(tags){
    tags.innerHTML = "";
    (d.data.tags || []).forEach(t=>{
      const el = document.createElement("div");
      el.className = "tag"; el.textContent = t;
      tags.appendChild(el);
    });
  }
}

/* breadcrumbs update */
function updateBreadcrumbs(node){
  const holder = document.getElementById("breadcrumbs");
  if(!holder) return;
  holder.innerHTML = "";
  const path = node ? node.ancestors().reverse() : root.ancestors().reverse();
  path.forEach((n, idx) => {
    const btn = document.createElement("button");
    btn.textContent = (idx === 0 ? "üè† " : "") + n.data.name;
    btn.style.background = "transparent"; btn.style.border = "none"; btn.style.color = "#9dd3b6";
    btn.addEventListener("click", ()=> { expandPathTo(n); renderTree(n); showDetails(n); });
    holder.appendChild(btn);
    if(idx < path.length-1){
      const sep = document.createElement("span"); sep.textContent = "‚Ä∫"; sep.style.opacity = "0.6"; sep.style.margin = "0 6px";
      holder.appendChild(sep);
    }
  });
}

/* expand parents of a node */
function expandPathTo(n){
  if(!n) return;
  let cur = n;
  while(cur.parent){
    if(cur.parent._children) { cur.parent.children = cur.parent._children; cur.parent._children = null; }
    cur = cur.parent;
  }
}

/* focus/pan to keep node visible */
function focusOnNode(d){
  // compute transform to center d
  const t = d3.zoomTransform(svg.node());
  const desiredX = width / 3;
  const desiredY = height / 2;
  const dx = desiredX - (d.y * t.k + t.x);
  const dy = desiredY - (d.x * t.k + t.y);
  svg.transition().duration(600).call(zoom.translateBy, dx / t.k, dy / t.k);
}

/* searchNodes used by header search */
function searchNodes(query){
  query = (query || "").trim().toLowerCase();
  if(!query){
    // clear highlights
    d3.selectAll("g.node circle").attr("stroke", "rgba(255,255,255,0.95)").attr("stroke-width",1);
    return;
  }
  const matches = [];
  root.each(d => {
    if((d.data.name || "").toLowerCase().includes(query)) matches.push(d);
  });
  if(matches.length === 0) return;
  // expand path to first match
  expandPathTo(matches[0]);
  renderTree(root);
  // highlight matches visually
  d3.selectAll("g.node circle").attr("stroke", d => matches.some(m=>m.id===d.id) ? "#00ffff" : "rgba(255,255,255,0.95)")
    .attr("stroke-width", d => matches.some(m=>m.id===d.id) ? 3 : 1);
  // focus on first match
  focusOnNode(matches[0]);
}

/* Export visible subtree (selectedNode or root) */
function exportJSON(node){
  const n = node || selectedNode || root;
  const subtree = cloneNode(n.data);
  const blob = new Blob([JSON.stringify(subtree, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url;
  a.download = `${(n.data.name||'subtree').replace(/\s+/g,'_')}.json`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

/* clone utility */
function cloneNode(data){ return JSON.parse(JSON.stringify(data)); }

/* recommendResources (keeps previous mapping) */
function recommendResources(data){
  const name = (data.name || "").toLowerCase();
  const list = [];
  const mapping = {
    "nmap":"https://nmap.org/","masscan":"https://github.com/robertdavidgraham/masscan",
    "nikto":"https://cirt.net/Nikto2","metasploit":"https://www.metasploit.com/",
    "ncat":"https://nmap.org/ncat/","volatility":"https://www.volatilityfoundation.org/",
    "sleuthkit":"https://www.sleuthkit.org/","autopsy":"https://www.sleuthkit.org/autopsy/",
    "yara":"https://virustotal.github.io/yara/","splunk":"https://www.splunk.com/",
    "osquery":"https://osquery.io/","zeek":"https://zeek.org/","suricata":"https://suricata.io/",
    "amass":"https://github.com/OWASP/Amass","sublist3r":"https://github.com/aboul3la/Sublist3r",
    "sqlmap":"http://sqlmap.org/","burp-suite":"https://portswigger.net/burp","gobuster":"https://github.com/OJ/gobuster",
    "dirb":"https://github.com/v0re/dirb","aws-cli":"https://aws.amazon.com/cli/","gcloud":"https://cloud.google.com/sdk",
    "kubectl":"https://kubernetes.io/docs/reference/kubectl/","terraform":"https://www.terraform.io/","john":"https://www.openwall.com/john/",
    "hashcat":"https://hashcat.net/hashcat/","impacket":"https://github.com/SecureAuthCorp/impacket","git":"https://git-scm.com/doc",
    "docker":"https://docs.docker.com/","openvas":"https://www.greenbone.net/en/oss/","cuckoo":"https://cuckoosandbox.org/"
  };
  Object.keys(mapping).forEach(k=>{ if(name.includes(k)) list.push({label:mapping[k], url:mapping[k]}); });
  if(list.length === 0) list.push({label:"Official docs & learning resources", url:"https://owasp.org/"});
  return list;
}

/* =========================
   End D3 section ‚Äî now connect header UI (search, filter, export, help)
   ========================= */

/* Hook up header controls safely (search, filter, export, help modal) */
(function hookupHeader(){
  // Search box
  const searchInput = document.getElementById("search");
  if(searchInput){
    let timer = null;
    searchInput.addEventListener("input", (e)=>{
      clearTimeout(timer);
      timer = setTimeout(()=> searchNodes(e.target.value), 250);
    });
    searchInput.addEventListener("keydown",(e)=> { if(e.key === "Escape"){ e.target.value=""; searchNodes(""); }});
  }

  // Populate role filter dropdown
  const roleFilter = document.getElementById("roleFilter");
  if(roleFilter){
    // clear existing but keep first "all"
    const existing = roleFilter.querySelectorAll("option");
    if(existing.length <= 1){
      // populate
      (root.children || []).forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.data.name; opt.textContent = c.data.name;
        roleFilter.appendChild(opt);
      });
    }
    roleFilter.addEventListener("change", (e)=>{
      const v = e.target.value;
      if(v === "all" || v === "All roles"){
        // collapse everything except root
        root.children && root.children.forEach(collapse);
        renderTree(root);
        centerTree();
        return;
      }
      // collapse all then expand target role
      root.children && root.children.forEach(collapse);
      const node = (root.children || []).find(c => c.data.name === v);
      if(node){
        // expand that node and ensure its first-level children visible
        expand(node);
        renderTree(node);
        expandPathTo(node);
        showDetails(node);
        focusOnNode(node);
      }
    });
  }

  // Export
  const exportBtn = document.getElementById("exportBtn");
  if(exportBtn){
    exportBtn.addEventListener("click", ()=> exportJSON(selectedNode || root));
  }

  // Help modal open/close
  const helpBtn = document.getElementById("helpBtn");
  const helpModal = document.getElementById("helpModal");
  const closeHelp = document.getElementById("closeHelp");
  if(helpBtn && helpModal){
    helpBtn.addEventListener("click", ()=> { helpModal.style.display = "block"; helpModal.setAttribute("aria-hidden","false"); });
  }
  if(closeHelp){
    closeHelp.addEventListener("click", ()=> { helpModal.style.display = "none"; helpModal.setAttribute("aria-hidden","true"); });
  }

  // Panel toggle (detailsPanel exists in your HTML)
  const togglePanelBtn = document.getElementById("togglePanel");
  const detailsPanel = document.getElementById("detailsPanel");
  if(togglePanelBtn && detailsPanel){
    togglePanelBtn.addEventListener("click", ()=>{
      if(detailsPanel.classList.contains("collapsed")){ detailsPanel.classList.remove("collapsed"); togglePanelBtn.setAttribute("aria-pressed","false"); }
      else { detailsPanel.classList.add("collapsed"); togglePanelBtn.setAttribute("aria-pressed","true"); }
    });
  }
})();

/* centerTree and initial render */
function centerTree(){
  svg.transition().duration(700).call(zoom.transform, d3.zoomIdentity.translate(120, height/2).scale(0.9));
}

renderTree(root);
centerTree();

/* END REPLACEMENT SECTION */


/* =========================
   4) Hook up UI controls: search, filter, export, help modal
   ========================= */
const searchInput = document.getElementById("search");
let searchTimer = null;
searchInput.addEventListener("input", (e)=>{
  clearTimeout(searchTimer);
  searchTimer = setTimeout(()=> searchNodes(e.target.value), 250);
});
searchInput.addEventListener("keydown",(e)=>{
  if(e.key === "Escape"){ e.target.value=""; searchNodes(""); }
});

const roleFilter = document.getElementById("roleFilter");
// populate role filter options from top-level roles
const roleNames = root.children ? root.children.map(c => c.data.name) : [];
roleNames.forEach(r=>{
  const opt = document.createElement("option");
  opt.value = r; opt.textContent = r;
  roleFilter.appendChild(opt);
});
roleFilter.addEventListener("change",(e)=>{
  const v = e.target.value;
  if(v === "all"){
    // expand root and collapse others
    collapseAll();
    renderTree(root);
    return;
  }
  // collapse all then expand the specified role
  collapseAll();
  const node = root.children.find(c => c.data.name === v);
  if(node){
    if(node._children) { node.children = node._children; node._children = null; }
    // also expand its first child
    if(node.children) node.children.forEach(c => { if(c._children){ c.children = c._children; c._children = null; } });
    renderTree(node);
    // focus
    expandTo(node.id);
    showDetails(node);
  }
});

document.getElementById("exportBtn").addEventListener("click", ()=>{
  exportJSON(selectedNode);
});

/* Help modal interactions */
const helpModal = document.getElementById("helpModal");
document.getElementById("helpBtn").addEventListener("click", ()=>{
  helpModal.style.display = "block";
  helpModal.setAttribute("aria-hidden","false");
  document.getElementById("closeHelp").focus();
});
document.getElementById("closeHelp").addEventListener("click", ()=>{
  helpModal.style.display = "none";
  helpModal.setAttribute("aria-hidden","true");
  document.getElementById("helpBtn").focus();
});

/* Panel toggle */
const detailsPanel = document.getElementById("detailsPanel");
document.getElementById("togglePanel").addEventListener("click", (e)=>{
  const btn = e.currentTarget;
  if(detailsPanel.classList.contains("collapsed")){
    detailsPanel.classList.remove("collapsed");
    btn.setAttribute("aria-pressed","false");
  } else {
    detailsPanel.classList.add("collapsed");
    btn.setAttribute("aria-pressed","true");
  }
});

/* Global keyboard shortcuts for accessibility */
document.addEventListener("keydown",(e)=>{
  if(e.key === "?" && e.shiftKey){ // Shift+? opens help
    helpModal.style.display="block"; helpModal.setAttribute("aria-hidden","false");
  }
  if(e.key === "Escape"){
    helpModal.style.display="none"; helpModal.setAttribute("aria-hidden","true");
  }
});

/* =========================
   Utility: show initial details (root)
   ========================= */
showDetails(root);

/* =========================
   Additional Notes:
   - To edit the dataset, modify the DATA object at top of the script.
   - Each node supports these properties: name, type, description, tags (array), children (array).
   - Commands are nodes with type "Command" and a "command" string.
   - The page is intentionally self-contained for offline use.
   ========================= */

</script>
</body>
</html>

